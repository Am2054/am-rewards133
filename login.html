<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>تسجيل الدخول / إنشاء حساب - Am Rewards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    :root{
      --main-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 60%, #38bdf8 100%);
      --glass-bg: rgba(255,255,255,0.13);
      --glass-border: rgba(56,189,248,0.18);
      --input-bg: rgba(30,41,59,0.74);
      --input-focus: #38bdf8;
      --input-border: #334155;
      --error: #f87171;
      --success: #22c55e;
      --muted: #a5f3fc;
      --radius: 36px;
      --shadow: 0 8px 32px 0 rgba(2,6,23,0.22);
      --gold: #FFD369;
      --gold-dark: #bfa243;
    }
    html, body{
      min-height:100vh;
      margin:0;
      padding:0;
      font-family:"Cairo","Montserrat",sans-serif;
      color:#f1f6fb;
      direction:rtl;
      background: var(--main-gradient), url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1200&q=80');
      background-size:cover;
      background-attachment:fixed;
      background-blend-mode:overlay;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
    }
    .bg-glass {
      position:fixed; 
      inset:0; 
      z-index:0; 
      pointer-events:none;
      background: radial-gradient(circle at 65% 17%, rgba(56,189,248,0.14) 0%, transparent 90%),
                  radial-gradient(circle at 25% 80%, rgba(34,197,94,0.16) 0%, transparent 80%);
      filter: blur(28px) saturate(1.3);
      animation: floatGlass 16s ease-in-out infinite alternate;
    }
    @keyframes floatGlass {
      0% { background-position: 65% 17%, 25% 80%;}
      100% { background-position: 55% 27%, 20% 95%;}
    }
    .center-box {
      width:100%;
      max-width: 600px;
      padding: 60px 40px 38px 40px;
      border-radius:var(--radius);
      background:var(--glass-bg);
      box-shadow: var(--shadow), 0 6px 32px 0 #0008;
      border:2px solid var(--glass-border);
      z-index:2;
      position:relative;
      backdrop-filter: blur(28px) saturate(120%);
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    /* حذف الشعار العلوي */
    .logo{display:none;}
    /* عنوان الصفحة */
    h2 {
      margin-bottom:20px;
      font-family:"Montserrat", "Cairo", sans-serif;
      font-size:2.3rem;
      font-weight:900;
      letter-spacing:1.2px;
      text-shadow:0 0 14px #38bdf8a3;
      color: #38bdf8; /* لون أزرق فاتح مميز */
    }
    .subtitle {
      color:var(--muted);
      font-size:1.13rem;
      margin-bottom:26px;
      font-weight:700;
      text-shadow:0 0 5px #38bdf8a1;
      letter-spacing:0.7px;
    }

    /* مربع Am Rewards الذهبي */
    .gold-name {
      display: block;
      background: var(--gold);
      color: var(--gold-dark);
      padding: 13px 27px 11px 27px;
      min-width: 150px;
      border-radius: 15px;
      font-size: 1.42rem;
      font-family: "Montserrat","Cairo",sans-serif;
      font-weight: 900;
      margin: 0 auto 32px auto;
      text-align: center;
      box-shadow: 0 4px 14px #FFD36944, 0 2px 12px #0003;
      letter-spacing: 1.7px;
      border: 2px solid #bfa24333;
      user-select: none;
    }

    .form-view { width:100%; }
    .form-row{
      margin-bottom:28px;
      text-align:right;
      position: relative;
    }
    label{
      font-size:1.18rem;
      color:var(--muted);
      margin-bottom:8px;
      display:block;
      font-weight:700;
    }
    input[type="text"], input[type="email"], input[type="password"], input[type="tel"]{
      width:100%;
      padding:25px 20px;
      border-radius:22px;
      border:2.2px solid var(--input-border);
      background: var(--input-bg);
      color:#fff;
      font-size:1.45rem;
      font-family:"Cairo",sans-serif;
      transition:box-shadow .18s, border-color .18s, transform .12s;
      outline:none;
      font-weight: 600;
      margin-top: 2px;
      box-sizing:border-box;
    }
    input:focus {
      border-color: var(--input-focus);
      box-shadow: 0 0 22px #38bdf8a6;
      background: #1e293b;
    }
    /* زر إظهار كلمة السر */
    .password-eye {
      position: absolute;
      left: 16px;
      top: 55%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.5em;
      color: #38bdf8;
      opacity: 0.85;
      z-index: 4;
      transition: color .17s;
      padding:0;
      margin:0;
      line-height:1;
      outline: none;
    }
    .password-eye:hover { color: #FFD369; }

    button {
      width:100%;
      padding:22px 0;
      border-radius:22px;
      font-size:1.38rem;
      font-weight:900;
      font-family:"Montserrat","Cairo",sans-serif;
      letter-spacing:0.8px;
      cursor:pointer;
      border:none;
      transition:.17s;
      margin-bottom:22px;
      box-shadow: 0 4px 24px rgba(56,189,248,0.14);
    }
    .login-btn{
      background:linear-gradient(90deg,#FFD369 0%,#bfa243 100%);
      color:#2e2300;
      font-weight:900;
      letter-spacing:1.2px;
      border:2px solid #bfa24366;
    }
    .login-btn:hover{
      background:linear-gradient(90deg,#bfa243 0%,#FFD369 100%);
      color:#fff;
    }
    .signup-btn{
      background:linear-gradient(90deg,#fb8500 0%,#ffb703 100%);
      color:#23272f;
      font-weight:900;
    }
    .signup-btn:hover{background:linear-gradient(90deg,#ffb703,#fb8500);color:#fff;}
    .switcher, .forgot {
      background:none;
      border:none;
      color:var(--muted);
      font-size:1.21rem;
      margin-bottom:2px;
      text-decoration:underline;
      cursor:pointer;
      transition:color .13s;
      font-weight:700;
    }
    .switcher:hover{color:#38bdf8;}
    .forgot {
      color:#fb8500;
      font-size:1.16rem;
      margin-top:-6px;
      margin-bottom:22px;
      font-weight:800;
    }
    .forgot:hover{color:#ffb703;}
    .message {
      min-height: 50px;
      padding: 21px 0 11px 0;
      margin-bottom: 24px;
      border-radius: 18px;
      font-size: 1.28rem;
      font-weight: bold;
      box-shadow: 0 2px 18px #0002;
      transition: .14s;
      background: #fff;
      color: #2e2300;
      text-shadow: none;
      border: 2px solid #FFD369;
      opacity: 1;
      display:block;
      text-align:center;
      position: relative;
    }
    .message .site-name {
      display: block;
      font-family: "Montserrat","Cairo",sans-serif;
      font-size: 1.22em;
      font-weight:900;
      color: var(--gold);
      margin-bottom: 5px;
      letter-spacing:1.3px;
      text-shadow:0 0 9px #FFD36977;
    }
    .error {
      background: #ffeaea !important;
      color: #c00 !important;
      border-color: #ff6b6b;
    }
    .success {
      background: #e7ffea !important;
      color: #049c3f !important;
      border-color: #22c55e;
    }
    .footer {
      margin-top: 36px;
      font-size: 1.19rem;
      color: #94a3b8;
      opacity: 0.9;
      font-weight: 500;
      text-align:center;
    }
    @media (max-width: 700px) {
      .center-box { 
        padding:12px 2vw 12px 2vw; 
        border-radius:20px;
        max-width: 99vw;
      }
      h2{font-size:1.3rem;}
      .subtitle{font-size:1.09rem;}
      .footer{font-size:.98rem;}
      input, button{font-size:1.06rem;}
      .form-row{margin-bottom:16px;}
      .gold-name {font-size:1.09rem;}
    }
  </style>
</head>
<body>
  <div class="bg-glass" aria-hidden="true"></div>
  <div class="center-box">
    <h2 id="form-title">تسجيل الدخول إلى Am Rewards</h2>
    <div class="subtitle">انضم وابدأ رحلتك للربح بسهولة وأمان</div>
    <span class="gold-name">Am Rewards</span>
    <div id="msg" class="message" style="display:none;">
      <span class="site-name">Am Rewards</span>
      <span id="msg-text"></span>
    </div>
    <div id="login-form" class="form-view">
      <div class="form-row">
        <label for="login-email">البريد الإلكتروني</label>
        <input type="email" id="login-email" placeholder="example@mail.com" autocomplete="username" />
      </div>
      <div class="form-row">
        <label for="login-password">كلمة المرور</label>
        <input type="password" id="login-password" placeholder="كلمة المرور" autocomplete="current-password" />
        <button type="button" class="password-eye" onclick="togglePassword('login-password', this)" tabindex="-1" aria-label="عرض كلمة المرور">
          <span id="eye-login" aria-hidden="true">&#128065;</span>
        </button>
      </div>
      <button class="login-btn" id="login-btn" onclick="login()">تسجيل الدخول</button>
      <button class="forgot" id="forgot-btn" onclick="resetPassword()">نسيت كلمة المرور؟</button>
    </div>
    <div id="signup-form" class="form-view" style="display:none">
      <div class="form-row">
        <label for="signup-name">الاسم الكامل</label>
        <input type="text" id="signup-name" placeholder="اسمك بالكامل" />
      </div>
      <div class="form-row">
        <label for="signup-phone">رقم الهاتف (مصر فقط)</label>
        <input type="tel" id="signup-phone" placeholder="01123456789" />
      </div>
      <div class="form-row">
        <label for="signup-email">البريد الإلكتروني</label>
        <input type="email" id="signup-email" placeholder="example@mail.com" autocomplete="username" />
      </div>
      <div class="form-row">
        <label for="signup-password">كلمة المرور</label>
        <input type="password" id="signup-password" placeholder="كلمة المرور (6 أحرف على الأقل)" autocomplete="new-password" />
        <button type="button" class="password-eye" onclick="togglePassword('signup-password', this)" tabindex="-1" aria-label="عرض كلمة المرور">
          <span id="eye-signup" aria-hidden="true">&#128065;</span>
        </button>
      </div>
      <div class="form-row">
        <label for="signup-confirm">تأكيد كلمة المرور</label>
        <input type="password" id="signup-confirm" placeholder="تأكيد كلمة المرور" autocomplete="new-password" />
        <button type="button" class="password-eye" onclick="togglePassword('signup-confirm', this)" tabindex="-1" aria-label="عرض كلمة المرور">
          <span id="eye-signup2" aria-hidden="true">&#128065;</span>
        </button>
      </div>
      <button class="signup-btn" id="signup-btn" onclick="signup()">إنشاء الحساب</button>
    </div>
    <button class="switcher" id="switcher" onclick="toggleMode()">أو أنشئ حساب جديد</button>
    <div class="footer">© 2025 Am Rewards • كل الحقوق محفوظة</div>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      setPersistence,
      browserLocalPersistence,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    const firebaseConfig = {
      apiKey: "AIzaSyBfOJPkWbmcJ6s29bDNysr-H0Kx-Js3Gy0",
      authDomain: "am--rewards.firebaseapp.com",
      projectId: "am--rewards",
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let isLogin = true;
    function showMessage(text, type="success") {
      const msg = document.getElementById("msg");
      const msgText = document.getElementById("msg-text");
      msgText.textContent = text;
      msg.className = "message " + type;
      msg.style.display = text ? "block" : "none";
    }
    function translateError(code) {
      switch(code) {
        case "auth/invalid-email": return "البريد الإلكتروني غير صالح";
        case "auth/user-not-found": return "المستخدم غير موجود";
        case "auth/wrong-password": return "كلمة المرور غير صحيحة";
        case "auth/email-already-in-use": return "هذا البريد مستخدم من قبل";
        case "auth/weak-password": return "كلمة المرور ضعيفة جدًا";
        case "auth/missing-password": return "يرجى إدخال كلمة المرور";
        case "auth/too-many-requests": return "تم حظر المحاولة مؤقتًا بسبب عدة محاولات خاطئة، انتظر قليلًا";
        default: return "حدث خطأ غير متوقع، حاول مرة أخرى";
      }
    }
    window.toggleMode = function () {
      isLogin = !isLogin;
      document.getElementById("login-form").style.display = isLogin ? "" : "none";
      document.getElementById("signup-form").style.display = isLogin ? "none" : "";
      document.getElementById("form-title").textContent = isLogin ? "تسجيل الدخول إلى Am Rewards" : "إنشاء حساب جديد في Am Rewards";
      document.getElementById("switcher").textContent = isLogin ? "أو أنشئ حساب جديد" : "أو سجّل الدخول";
      showMessage("", "success");
    };
    function validateEgyptianPhone(phone) {
      return /^(010|011|012|015)[0-9]{8}$/.test(phone);
    }
    window.login = async function () {
      const email = document.getElementById("login-email").value.trim();
      const password = document.getElementById("login-password").value.trim();
      const btn = document.getElementById("login-btn");
      if (!email || !password) return showMessage("يرجى إدخال البريد وكلمة المرور", "error");
      btn.textContent = "جاري الدخول...";
      btn.disabled = true;
      try {
        await setPersistence(auth, browserLocalPersistence);
        const result = await signInWithEmailAndPassword(auth, email, password);
        const uid = result.user.uid;
        const ref = doc(db, "users", uid);
        const snapshot = await getDoc(ref);
        if (!snapshot.exists()) {
          await setDoc(ref, {
            uid: uid,
            name: "مستخدم جديد",
            email: email,
            phone: "",
            points: 0,
            bonusPoint: 0,
            totalWithdrawn: 0,
            dailyWithdrawAmount: 0,
            isBanned: false,
            lastWithdrawlDate: "",
            joinedAt: serverTimestamp(),
          });
        }
        showMessage("✅ تم تسجيل الدخول بنجاح!", "success");
        setTimeout(()=> window.location.href = "dashboard.html", 1500);
      } catch (error) {
        btn.textContent = "تسجيل الدخول";
        btn.disabled = false;
        showMessage(translateError(error.code), "error");
      }
    };
    window.signup = async function () {
      const name = document.getElementById("signup-name").value.trim();
      const phone = document.getElementById("signup-phone").value.trim();
      const email = document.getElementById("signup-email").value.trim();
      const password = document.getElementById("signup-password").value.trim();
      const confirm = document.getElementById("signup-confirm").value.trim();
      const btn = document.getElementById("signup-btn");
      if (!name || !phone || !email || !password || !confirm)
        return showMessage("يرجى تعبئة جميع الحقول", "error");
      if (password.length < 6)
        return showMessage("كلمة المرور يجب أن تكون 6 أحرف على الأقل", "error");
      if (password !== confirm)
        return showMessage("كلمة المرور وتأكيدها غير متطابقين", "error");
      if (!validateEgyptianPhone(phone))
        return showMessage("رقم الهاتف يجب أن يكون مصري صحيح مثل 011xxxxxxxx", "error");
      if (email === "amirfg992005@gmail.com")
        return showMessage("❌ هذا البريد محجوز ولا يمكن استخدامه.", "error");
      btn.textContent = "جاري التسجيل...";
      btn.disabled = true;
      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const uid = userCredential.user.uid;
        await setDoc(doc(db, "users", uid), {
          uid: uid,
          name: name,
          email: email,
          phone: phone,
          points: 0,
          bonusPoint: 0,
          totalWithdrawn: 0,
          dailyWithdrawAmount: 0,
          isBanned: false,
          lastWithdrawlDate: "",
          joinedAt: serverTimestamp(),
        });
        showMessage("✅ تم إنشاء الحساب بنجاح!", "success");
        setTimeout(()=> window.location.href = "dashboard.html", 1500);
      } catch (error) {
        btn.textContent = "إنشاء الحساب";
        btn.disabled = false;
        showMessage(translateError(error.code), "error");
      }
    };
    window.resetPassword = async function () {
      const email = document.getElementById("login-email").value.trim();
      const btn = document.getElementById("forgot-btn");
      if (!email) {
        showMessage("أدخل بريدك الإلكتروني لإعادة تعيين كلمة المرور", "error");
        return;
      }
      btn.textContent = "جارٍ الإرسال...";
      btn.disabled = true;
      try {
        await sendPasswordResetEmail(auth, email);
        showMessage("تم إرسال رابط إعادة تعيين كلمة المرور إلى بريدك الإلكتروني. تحقق من البريد الوارد أو غير الهام.", "success");
      } catch (error) {
        showMessage(translateError(error.code), "error");
      }
      btn.textContent = "نسيت كلمة المرور؟";
      btn.disabled = false;
    };
    // زر إظهار/إخفاء كلمة المرور
    window.togglePassword = function(id, btn) {
      const input = document.getElementById(id);
      if (input.type === "password") {
        input.type = "text";
        btn.innerHTML = "&#128064;"; // رمز العين المفتوحة
      } else {
        input.type = "password";
        btn.innerHTML = "&#128065;"; // رمز العين المغلقة
      }
    }
  </script>
</body>
  </html>
