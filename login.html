<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>تسجيل الدخول - Am Rewards</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">

<style>
:root {
  --main-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 60%, #38bdf8 100%);
  --dark-box-bg: rgba(2,6,23,0.95);
  --glass-border: rgba(56,189,248,0.18);
  --input-bg: rgba(30,41,59,0.9);
  --input-border: #334155;
  --muted: #a5f3fc;
  --radius: 28px;
  --shadow: 0 8px 32px 0 rgba(2,6,23,0.4);
  --gold: #FFD369;
  --gold-dark: #bfa243;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Cairo", sans-serif;
  background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.9)), var(--main-gradient);
  color: #f1f6fb;
}

.center-box {
  max-width: 420px;
  margin: 70px auto;
  padding: 38px 25px;
  border-radius: var(--radius);
  background: var(--dark-box-bg);
  border: 2px solid var(--glass-border);
  box-shadow: var(--shadow);
  text-align: center;
}

h2 {
  color: #38bdf8;
  font-family: "Montserrat";
}

.gold-name {
  background: var(--gold);
  color: var(--gold-dark);
  padding: 10px 20px;
  border-radius: 12px;
  font-weight: 900;
  margin-bottom: 25px;
  display: inline-block;
}

.form-row {
  text-align: right;
  margin-bottom: 18px;
}

label {
  display: block;
  margin-bottom: 8px;
  color: var(--muted);
  font-weight: 700;
}

input {
  width: 100%;
  padding: 16px 15px;
  border-radius: 15px;
  border: 2px solid var(--input-border);
  background: var(--input-bg);
  color: #fff;
  font-size: 1.05rem;
  outline: none;
}

.login-btn {
  width: 100%;
  padding: 14px;
  border-radius: 15px;
  border: none;
  font-weight: 900;
  cursor: pointer;
  background: linear-gradient(90deg, #FFD369, #bfa243);
  color: #2e2300;
  font-size: 1.1rem;
}

.login-btn:disabled {
  opacity: .6;
  cursor: not-allowed;
}

.spinner {
  width: 18px;
  height: 18px;
  border: 3px solid rgba(255,255,255,.3);
  border-top-color: #fff;
  border-radius: 50%;
  display: inline-block;
  animation: spin .8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
</head>

<body>

<div class="center-box">
  <h2>Am Rewards</h2>
  <span class="gold-name">تسجيل الدخول</span>

  <!-- الفورم بدون submit -->
  <form onsubmit="return false;">
    <div class="form-row">
      <label>البريد الإلكتروني</label>
      <input type="email" id="login-email" />
    </div>

    <div class="form-row">
      <label>كلمة المرور</label>
      <input type="password" id="login-password" />
    </div>

    <!-- زر Button فقط -->
    <button type="button" class="login-btn" id="btn-login">
      تسجيل الدخول
    </button>
  </form>

  <a href="signup.html" style="color:var(--muted); margin-top:20px; display:block;">
    إنشاء حساب
  </a>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBfOJPkWbmcJ6s29bDNysr-H0Kx-Js3Gy0",
  authDomain: "am--rewards.firebaseapp.com",
  projectId: "am--rewards"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const btn = document.getElementById("btn-login");

btn.onclick = async () => {
  const email = document.getElementById("login-email").value.trim();
  const password = document.getElementById("login-password").value;

  if (!email || !password) {
    alert("من فضلك أدخل البريد الإلكتروني وكلمة المرور");
    return;
  }

  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> جاري الدخول...';

  try {
    await setPersistence(auth, browserLocalPersistence);
    const cred = await signInWithEmailAndPassword(auth, email, password);

    const userRef = doc(db, "users", cred.user.uid);
    const snap = await getDoc(userRef);

    if (!snap.exists()) throw new Error("NO_USER");
    if (snap.data().isBanned === true) throw new Error("BANNED");

    await updateDoc(userRef, {
      lastLogin: serverTimestamp()
    });

    location.href = "dashboard.html";

  } catch (e) {
    alert("بيانات الدخول غير صحيحة");
    btn.disabled = false;
    btn.innerHTML = "تسجيل الدخول";
  }
};
</script>

</body>
  </html>
