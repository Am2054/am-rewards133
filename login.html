<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Am Rewards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">

  <style>
    :root {
      --main-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 60%, #38bdf8 100%);
      --dark-box-bg: rgba(2,6,23,0.95);
      --glass-border: rgba(56,189,248,0.18);
      --input-bg: rgba(30,41,59,0.9);
      --input-focus: #38bdf8;
      --input-border: #334155;
      --muted: #a5f3fc;
      --radius: 28px;
      --shadow: 0 8px 32px 0 rgba(2,6,23,0.4);
      --gold: #FFD369;
      --gold-dark: #bfa243;
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      font-family: "Cairo", sans-serif;
      background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.9)), var(--main-gradient);
      color: #f1f6fb;
    }

    .center-box {
      max-width: 420px;
      margin: 60px auto;
      padding: 38px 25px;
      border-radius: var(--radius);
      background: var(--dark-box-bg);
      border: 2px solid var(--glass-border);
      box-shadow: var(--shadow);
      text-align: center;
    }

    h2 { color: #38bdf8; font-family: "Montserrat"; margin-bottom: 6px; }

    .gold-name {
      background: var(--gold);
      color: var(--gold-dark);
      padding: 10px 20px;
      border-radius: 12px;
      font-weight: 900;
      margin-bottom: 25px;
      display: inline-block;
    }

    .form-row { text-align: right; margin-bottom: 18px; }

    label {
      display: block;
      margin-bottom: 8px;
      color: var(--muted);
      font-weight: 700;
    }

    input {
      width: 100%;
      padding: 16px 15px 16px 45px;
      border-radius: 15px;
      border: 2px solid var(--input-border);
      background: var(--input-bg);
      color: #fff;
      font-size: 1.1rem;
      outline: none;
      transition: .3s;
    }

    input:focus {
      border-color: var(--input-focus);
      box-shadow: 0 0 12px rgba(56,189,248,.4);
    }

    .input-group { position: relative; }

    .password-toggle {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #38bdf8;
      cursor: pointer;
    }

    .login-btn {
      width: 100%;
      padding: 14px;
      border-radius: 15px;
      border: none;
      font-weight: 900;
      cursor: pointer;
      background: linear-gradient(90deg, #FFD369, #bfa243);
      color: #2e2300;
      font-size: 1.1rem;
    }

    .login-btn:disabled { opacity: .6; cursor: not-allowed; }

    .spinner {
      width: 18px;
      height: 18px;
      border: 3px solid rgba(255,255,255,.3);
      border-top-color: #fff;
      border-radius: 50%;
      display: inline-block;
      animation: spin .8s linear infinite;
      vertical-align: middle;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .message {
      display: none;
      padding: 12px;
      margin-bottom: 14px;
      border-radius: 10px;
      font-weight: bold;
    }

    .message.error { background:#ffeaea; color:#c00; }
    .message.success { background:#e7ffea; color:#049c3f; }
  </style>
</head>

<body>
<div class="center-box">
  <h2>Am Rewards</h2>
  <span class="gold-name">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>

  <div id="msg" class="message"></div>

  <!-- âœ… Form Ù…Ø¶Ø§Ù Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù Ø£ÙŠ Ø¹Ù†ØµØ± -->
  <form id="login-form" autocomplete="off">

    <div class="form-row">
      <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
      <input type="email" id="login-email" placeholder="example@mail.com" />
    </div>

    <div class="form-row">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <div class="input-group">
        <input type="password" id="login-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
        <button type="button" id="btn-toggle" class="password-toggle"
          aria-label="Ø¥Ø¸Ù‡Ø§Ø± Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
          ğŸ‘
        </button>
      </div>
    </div>

    <button type="button" class="login-btn" id="btn-login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  </form>

  <a href="signup.html" style="color:var(--muted); margin-top:20px; display:block; text-decoration:none;">
    Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
  </a>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBfOJPkWbmcJ6s29bDNysr-H0Kx-Js3Gy0",
  authDomain: "am--rewards.firebaseapp.com",
  projectId: "am--rewards"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const btnLogin = document.getElementById("btn-login");
const msgBox = document.getElementById("msg");
const inputPass = document.getElementById("login-password");
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

let isLoggingIn = false;

// ğŸ‘ Toggle password
document.getElementById("btn-toggle").onclick = () => {
  inputPass.type = inputPass.type === "password" ? "text" : "password";
};

// ğŸ” Login
btnLogin.onclick = async () => {
  if (isLoggingIn) return;
  isLoggingIn = true;

  const email = document.getElementById("login-email").value.trim();
  const password = inputPass.value;

  if (!email || !password || !emailRegex.test(email)) {
    msgBox.textContent = "âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
    msgBox.className = "message error";
    msgBox.style.display = "block";
    isLoggingIn = false;
    return;
  }

  btnLogin.disabled = true;
  btnLogin.innerHTML = '<span class="spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';

  try {
    await setPersistence(auth, browserLocalPersistence);
    const cred = await signInWithEmailAndPassword(auth, email, password);

    await setDoc(doc(db, "users", cred.user.uid), {
      lastLogin: serverTimestamp()
    }, { merge: true });

    const adminSnap = await getDoc(doc(db, "admins", email));
    const isAdmin = adminSnap.exists() && adminSnap.data().active === true;

    msgBox.textContent = "âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
    msgBox.className = "message success";
    msgBox.style.display = "block";

    setTimeout(() => {
      location.href = isAdmin ? "admin.html" : "dashboard.html";
    }, 1000);

  } catch {
    msgBox.textContent = "âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
    msgBox.className = "message error";
    msgBox.style.display = "block";
  }

  btnLogin.disabled = false;
  btnLogin.innerHTML = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
  isLoggingIn = false;
};

// âŒ¨ï¸ Enter support
document.getElementById("login-form").addEventListener("submit", e => {
  e.preventDefault();
  btnLogin.click();
});
</script>
</body>
          </html>
