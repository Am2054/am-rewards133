<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>مهمة أدوات الذكاء الاصطناعي | Am Rewards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Tajawal&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(to bottom right, #e6f9ed, #ffffff);
      margin: 0;
      padding: 20px;
    }
    h2 {
      color: #28a745;
      text-align: center;
      font-size: 26px;
      margin-bottom: 10px;
    }
    .link-box {
      background: white;
      padding: 15px;
      border: 1px solid #d4d4d4;
      margin: 10px auto;
      max-width: 420px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }
    .link-box button {
      background-color: #007bff;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    .counter, #user-points {
      text-align: center;
      margin: 15px auto;
      font-size: 18px;
      color: #333;
    }
    #user-points {
      background: #fff3cd;
      padding: 10px;
      border-radius: 10px;
      max-width: 320px;
      border: 1px solid #ffeeba;
    }
    .back-buttons {
      text-align: center;
      margin-top: 30px;
    }
    .back-buttons button {
      margin: 8px;
      background-color: #28a745;
      padding: 10px 20px;
      border: none;
      color: white;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>مهمة أدوات الذكاء الاصطناعي</h2>
  <div id="user-points">نقاطي: ...</div>
  <div class="counter" id="status">جاري تحميل الأدوات...</div>
  <div id="links-container"></div>
  <div class="back-buttons">
    <a href="dashboard.html"><button>🔙 العودة إلى الصفحة الرئيسية</button></a>
    <a href="tasks.html"><button>🗂️ العودة إلى صفحة المهام</button></a>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc, increment, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";const firebaseConfig = {
  apiKey: "AIzaSyBfOJPkWbmcJ6s29bDNysr-H0Kx-Js3Gy0",
  authDomain: "am--rewards.firebaseapp.com",
  projectId: "am--rewards"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const tools = [
  { title: "أداة 1", url: "https://tool1.ai" },
  { title: "أداة 2", url: "https://tool2.ai" },
  { title: "أداة 3", url: "https://tool3.ai" },
  { title: "أداة 4", url: "https://tool4.ai" },
  { title: "أداة 5", url: "https://tool5.ai" },
  { title: "أداة 6", url: "https://tool6.ai" },
  { title: "أداة 7", url: "https://tool7.ai" },
  { title: "أداة 8", url: "https://tool8.ai" },
  { title: "أداة 9", url: "https://tool9.ai" },
  { title: "أداة 10", url: "https://tool10.ai" },
  { title: "أداة 11", url: "https://tool11.ai" },
  { title: "أداة 12", url: "https://tool12.ai" },
  { title: "أداة 13", url: "https://tool13.ai" },
  { title: "أداة 14", url: "https://tool14.ai" },
  { title: "أداة 15", url: "https://tool15.ai" },
  { title: "أداة 16", url: "https://tool16.ai" },
  { title: "أداة 17", url: "https://tool17.ai" },
  { title: "أداة 18", url: "https://tool18.ai" },
  { title: "أداة 19", url: "https://tool19.ai" },
  { title: "أداة 20", url: "https://tool20.ai" }
];

onAuthStateChanged(auth, user => {
  if (!user) return alert("⚠️ يجب تسجيل الدخول.") || (window.location.href = "index.html");
  const userId = user.uid;
  const container = document.getElementById("links-container");
  const status = document.getElementById("status");
  let completed = JSON.parse(localStorage.getItem("ai_tasks_done_" + userId)) || [];

  tools.forEach((tool, i) => {
    const box = document.createElement("div");
    box.className = "link-box";
    const done = completed.includes(i);
    box.innerHTML = `
      <p>${tool.title}</p>
      <p>🪙 تمنحك <strong>1.5</strong> نقطة</p>
      <button ${done ? "disabled" : ""} onclick="completeTask(${i}, '${tool.url}')">${done ? "✅ مكتملة" : "فتح الأداة"}</button>
    `;
    container.appendChild(box);
  });

  status.textContent = `أدوات مكتملة: ${completed.length} / ${tools.length}`;

  window.completeTask = function(index, url) {
    window.open(url, "_blank");
    if (!completed.includes(index)) {
      completed.push(index);
      localStorage.setItem("ai_tasks_done_" + userId, JSON.stringify(completed));

      const userDocRef = doc(db, "users", userId);
      updateDoc(userDocRef, {
        points: increment(1.5)
      });

      const logRef = collection(db, "adminTaskLogs");
      addDoc(logRef, {
        userId,
        taskType: "ai_tool",
        rewardToUser: 1.5,
        profitToAdmin: 0.4,
        date: new Date()
      });

      setTimeout(() => location.reload(), 800);
    }
  }
});

  </script>
</body>
</html>
