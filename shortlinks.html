<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>مهمة الروابط المختصرة | Am Rewards</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal&display=swap" rel="stylesheet" />
    <style>
      body {
        font-family: "Tajawal", sans-serif;
        background-color: #f5f5f5;
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 600px;
        margin: 40px auto;
        background-color: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        text-align: center;
      }
      h2 {
        color: #4caf50;
      }
      .link-box {
        background-color: #e8f5e9;
        padding: 15px;
        margin: 15px 0;
        border-radius: 10px;
        border: 1px solid #c8e6c9;
      }
      .link-box a {
        display: inline-block;
        margin-top: 10px;
        padding: 10px 20px;
        background-color: #4caf50;
        color: white;
        text-decoration: none;
        border-radius: 5px;
      }
    </style>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import {
        getFirestore,
        doc,
        updateDoc,
        arrayUnion,
        increment,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
      import {
        getAuth,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCY-Q9K1GzS8lvWb9ITmpj6bbPfQZHKefk",
        authDomain: "am--rewards.firebaseapp.com",
        projectId: "am--rewards",
        storageBucket: "am--rewards.appspot.com",
        messagingSenderId: "51585715948",
        appId: "1:51585715948:web:9f5918fe3b68b2b453fb7e",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      const shortlinks = [
        { title: "رابط 1", url: "https://exe.io/GXmF3F" },
        { title: "رابط 2", url: "https://exe.io/NYY4L" },
        { title: "رابط 3", url: "https://exe.io/sA8yK" },
        { title: "رابط 4", url: "https://exe.io/b6pud9" },
        { title: "رابط 5", url: "https://exe.io/mLfYLv" },
        { title: "رابط 6", url: "https://exe.io/hjvvR" },
        { title: "رابط 7", url: "https://exe.io/roaaW" },
        { title: "رابط 8", url: "https://exe.io/EZzmEMe" },
        { title: "رابط 9", url: "https://exe.io/GZNmGk" },
        { title: "رابط 10", url: "https://exe.io/YO2Y1g" },
        { title: "رابط 11", url: "https://exe.io/Bqv9r7W" },
        { title: "رابط 12", url: "https://exe.io/8cD2i" },
        { title: "رابط 13", url: "https://exe.io/MYAHf" },
        { title: "رابط 14", url: "https://exe.io/gKRUGh" },
        { title: "رابط 15", url: "https://exe.io/y6TT8h" },
        { title: "رابط 16", url: "https://exe.io/BlY6H" },
        { title: "رابط 17", url: "https://exe.io/3Q84s" },
        { title: "رابط 18", url: "https://exe.io/MR1V6F" },
        { title: "رابط 19", url: "https://exe.io/j7ndBi" },
        { title: "رابط 20", url: "https://exe.io/yE9u3p6" },
        { title: "رابط 21", url: "https://exe.io/HYoA4" },
        { title: "رابط 22", url: "https://exe.io/tCWi5kM" },
        { title: "رابط 23", url: "https://exe.io/mDnXvUO" },
        { title: "رابط 24", url: "https://exe.io/BsbJTWx" },
        { title: "رابط 25", url: "https://exe.io/PRg3TQ" },
        { title: "رابط 26", url: "https://exe.io/VQVEgE" },
        { title: "رابط 27", url: "https://exe.io/Wfx6p9" },
        { title: "رابط 28", url: "https://exe.io/NBEFt" },
        { title: "رابط 29", url: "https://exe.io/4w2GV" },
        { title: "رابط 30", url: "https://exe.io/MHeoYh" },
        { title: "رابط 31", url: "https://exe.io/GwTAKa" },
        { title: "رابط 32", url: "https://exe.io/HHkU2" },
        { title: "رابط 33", url: "https://exe.io/OAzEP" },
        { title: "رابط 34", url: "https://exe.io/m0sTj" },
        { title: "رابط 35", url: "https://exe.io/6MbtTA" },
        { title: "رابط 36", url: "https://exe.io/w0U4V" },
        { title: "رابط 37", url: "https://exe.io/ek8TD" },
        { title: "رابط 38", url: "https://exe.io/8yboQOu" },
      ];

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const userRef = doc(db, "users", user.uid);
          const userSnap = await getDoc(userRef);
          const completedTasks = userSnap.exists()
            ? userSnap.data().completedTasks || []
            : [];

          const container = document.querySelector(".container");

          shortlinks.forEach((link) => {
            if (!completedTasks.includes(link.title)) {
              const box = document.createElement("div");
              box.className = "link-box";
              box.innerHTML = `
                <h3>${link.title}</h3>
                <p>🪙 هذه المهمة تمنحك <strong>1.5</strong> نقطة</p>
                <a href="${link.url}" target="_blank">فتح الرابط</a>
              `;
              box.querySelector("a").addEventListener("click", async () => {
                await updateDoc(userRef, {
                  points: increment(1.5),
                  completedTasks: arrayUnion(link.title),
                  taskHistory: arrayUnion({
                    task: link.title,
                    type: "shortlink",
                    timestamp: new Date(),
                    rewardToUser: 1.5,
                  }),
                });
              });
              container.appendChild(box);
            }
          });
        } else {
          window.location.href = "/login.html";
        }
      });
    </script>
  </head>
  <body>
    <div class="container">
      <h2>مهمة الروابط المختصرة</h2>
      <p>قم بفتح الروابط التالية لإتمام المهام وكسب النقاط</p>
    </div>
  </body>
</html>
