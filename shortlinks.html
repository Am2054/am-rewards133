<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AM REWARDS | SHORT-LINKS HUB</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Syncopate:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #030712; --card: rgba(17, 24, 39, 0.8);
      --gold: #f5c542; --accent: #00fa9a;
      --text: #eef2f7; --border: rgba(245, 197, 66, 0.1);
    }

    body {
      font-family: 'Cairo', sans-serif; background: var(--bg);
      color: var(--text); margin: 0; padding: 20px;
      background-image: radial-gradient(circle at top, #1e293b, #030712);
      min-height: 100vh;
    }

    .header-section { text-align: center; margin-bottom: 30px; }
    h2 { font-family: 'Syncopate'; color: var(--gold); letter-spacing: 2px; font-size: 1.4rem; margin-bottom: 10px; }
    
    #user-points {
      background: var(--card); border: 1px solid var(--gold);
      padding: 10px 25px; border-radius: 50px; display: inline-flex;
      align-items: center; gap: 10px; font-weight: 900; color: var(--gold);
      box-shadow: 0 0 20px rgba(245, 197, 66, 0.1);
    }

    #status { font-size: 0.9rem; margin: 15px 0; color: var(--accent); opacity: 0.8; }
    #err { color: #ff5252; font-size: 0.85rem; height: 20px; }

    /* ÿ¥ÿ®ŸÉÿ© ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ */
    #links-container {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px; max-width: 1100px; margin: 0 auto;
    }

    .link-card {
      background: var(--card); border: 1px solid var(--border);
      padding: 25px; border-radius: 24px; position: relative;
      transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      backdrop-filter: blur(10px); text-align: center;
    }

    .link-card:hover { transform: translateY(-8px); border-color: var(--gold); }

    .link-card p { margin: 0 0 20px 0; font-weight: 700; font-size: 1.1rem; }
    
    .reward-badge {
      position: absolute; top: -10px; left: 20px; background: var(--gold);
      color: #000; padding: 2px 12px; border-radius: 8px; font-size: 0.75rem; font-weight: 900;
    }

    .btn-action {
      width: 100%; padding: 12px; border-radius: 12px; border: none;
      font-weight: 900; cursor: pointer; transition: 0.3s;
      background: var(--accent); color: #030712; font-size: 1rem;
    }

    .btn-action:disabled {
      background: rgba(255,255,255,0.05); color: #64748b; cursor: not-allowed;
    }

    .timer-lock {
      margin-top: 15px; font-size: 0.8rem; color: #94a3b8;
      display: flex; align-items: center; justify-content: center; gap: 5px;
    }

    .back-nav {
      margin-top: 50px; display: flex; justify-content: center; gap: 15px;
    }
    .btn-nav {
      background: transparent; border: 1px solid var(--border);
      color: var(--text); padding: 10px 20px; border-radius: 12px;
      cursor: pointer; font-weight: 700; text-decoration: none;
    }
    .btn-nav:hover { background: var(--card); border-color: var(--gold); }

    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    .loading-pulse { animation: pulse 1.5s infinite; }
  </style>
</head>
<body>

  <div class="header-section">
    <h2>LINKS REWARDS HUB</h2>
    <div id="user-points">ü™ô POINTS: <span id="points-val">0</span></div>
    <div id="status">INITIALIZING SYSTEM...</div>
    <div id="err"></div>
  </div>

  <div id="links-container">
      </div>

  <div class="back-nav">
    <a href="dashboard.html" class="btn-nav">üîô DASHBOARD</a>
    <a href="tasks.html" class="btn-nav">üóÇÔ∏è ALL TASKS</a>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBfOJPkWbmcJ6s29bDNysr-H0Kx-Js3Gy0",
  authDomain: "am--rewards.firebaseapp.com",
  projectId: "am--rewards"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const POINTS_PER_LINK = 5; // ÿ™ŸÖ ÿßŸÑÿ±ŸÅÿπ ŸÑŸÄ 5 ŸÑÿ≤ŸäÿßÿØÿ© ÿßŸÑÿ≠ŸÖÿßÿ≥
const LINK_COOLDOWN = 24 * 60 * 60 * 1000;
const MIN_WAIT_TIME = 15000;

// ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÄ 20 ÿ±ÿßÿ®ÿ∑ÿßŸã ÿßŸÑÿ™Ÿä ÿßÿÆÿ™ÿ±ÿ™Ÿáÿß ÿ£ŸÜÿ™
const shortlinks = [
  {title:"SwiftLnx Server", url:"https://swiftlnx.com/RRIj1Sni"},
  {title:"Exe Engine", url:"https://exe.io/ED0ipEN"},
  {title:"YShorten Node", url:"https://yshorten.com/OZpCcW9"},
  {title:"OII Network", url:"https://oii.la/LcWIK3BD"},
  {title:"Jambo Ink", url:"https://short-jambo.ink/6XeL7"},
  {title:"TPI Gateway", url:"https://tpi.li/e6TZ8SqRPLi"},
  {title:"ShrinkMe Click", url:"https://shrinkme.click/k4EXrq"},
  {title:"ShortSlug Biz", url:"https://shrtslug.biz/8xx8c"},
  {title:"RevLink Pro", url:"https://revlink.pro/Egc9E"},
  {title:"CutWin Express", url:"https://cutw.in/tFu9b17C"},
  {title:"LinkJust Hub", url:"https://linkjust.com/ooilAAdJ"},
  {title:"GP Links X", url:"https://gplinks.co/XA30n0vz"},
  {title:"TMEarn Network", url:"https://tmearn.net/link/82sq"},
  {title:"UII IO Shield", url:"https://uii.io/INzfKhNW"},
  {title:"Link4Earn Main", url:"https://go.link4earn.in/jtXBvLz"},
  {title:"ShortFly MT", url:"https://www.short-fly.com/MTGN"},
  {title:"LNBZ Global", url:"https://lnbz.la/eAUo"},
  {title:"DropLink Cloud", url:"https://droplink.co/gXE1an"},
  {title:"XP Short Link", url:"https://xpshort.com/oBwyc"},
  {title:"Easy4Skip Portal", url:"http://easy4skip.com/TJmg"}
];

let currentUserRef = null;
let serverTimeOffset = 0;

onAuthStateChanged(auth, async (user) => {
  if (!user) { location.href = "index.html"; return; }
  currentUserRef = doc(db, "users", user.uid);
  
  // ŸÖÿ≤ÿßŸÖŸÜÿ© ÿßŸÑŸàŸÇÿ™
  const nowRef = doc(db, "system", "time");
  await setDoc(nowRef, { time: serverTimestamp() });
  const nowSnap = await getDoc(nowRef);
  serverTimeOffset = (nowSnap.data()?.time?.toMillis() || Date.now()) - Date.now();

  await checkPendingReward();

  onSnapshot(currentUserRef, (snap) => {
    const data = snap.data() || {};
    document.getElementById("points-val").textContent = data.points || 0;
    renderUI(data.lastLinks || {});
    document.getElementById("status").textContent = "üì° SYSTEM OPERATIONAL";
  });
});

async function checkPendingReward() {
  const linkIdx = localStorage.getItem("p_idx");
  const startTime = localStorage.getItem("p_time");
  if (!linkIdx || !startTime) return;

  const now = Date.now() + serverTimeOffset;
  const elapsed = now - Number(startTime);

  if (elapsed >= MIN_WAIT_TIME) {
    try {
      await updateDoc(currentUserRef, {
        points: increment(POINTS_PER_LINK),
        [`lastLinks.${linkIdx}`]: serverTimestamp()
      });
      alert(`‚úÖ MISSION COMPLETE: +${POINTS_PER_LINK} Points`);
    } catch (e) { console.error("Reward Error", e); }
  } else {
    alert("‚ö†Ô∏è ÿ™ŸÖ ÿßŸÉÿ™ÿ¥ÿßŸÅ ÿπŸàÿØÿ© ÿ≥ÿ±Ÿäÿπÿ©! Ÿäÿ¨ÿ® ÿßŸÑÿ®ŸÇÿßÿ° 15 ÿ´ÿßŸÜŸäÿ© ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ.");
  }
  localStorage.removeItem("p_idx");
  localStorage.removeItem("p_time");
}

function renderUI(lastLinks) {
  const container = document.getElementById("links-container");
  container.innerHTML = "";
  const now = Date.now() + serverTimeOffset;

  shortlinks.forEach((item, i) => {
    const lastTime = lastLinks[i]?.toMillis ? lastLinks[i].toMillis() : (lastLinks[i] || 0);
    const isLocked = lastTime && (now - lastTime < LINK_COOLDOWN);
    
    const card = document.createElement("div");
    card.className = "link-card";
    
    let timerHTML = "";
    if (isLocked) {
      const diff = LINK_COOLDOWN - (now - lastTime);
      const h = Math.floor(diff / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      timerHTML = `<div class="timer-lock">‚è≥ Recharges in ${h}h ${m}m</div>`;
    }

    card.innerHTML = `
      <div class="reward-badge">+${POINTS_PER_LINK} PTS</div>
      <p>${item.title}</p>
      <button class="btn-action" ${isLocked ? "disabled" : ""} 
        onclick="window.openLink(${i}, '${item.url}')">
        ${isLocked ? "LOCKED" : "EXECUTE TASK"}
      </button>
      ${timerHTML}
    `;
    container.appendChild(card);
  });
}

window.openLink = (i, url) => {
  localStorage.setItem("p_idx", i);
  localStorage.setItem("p_time", Date.now() + serverTimeOffset);
  window.location.href = url;
};
</script>
</body>
</html>
