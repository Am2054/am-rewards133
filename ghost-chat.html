<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Ø´Ø§Øª Ø§Ù„Ø£Ø´Ø¨Ø§Ø­ PRO | AM Rewards</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --cyan: #00f2ff; 
            --purple: #7000ff; 
            --dark: #020617; 
            --danger: #ff4444; 
            --system: #94a3b8;
            --success: #10b981;
        }

        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background: var(--dark); }

        body { 
            font-family: 'Tajawal', sans-serif; 
            color: #fff; 
            display: flex; 
            flex-direction: column; 
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ÙŠØ© Ø§Ù„Ù…Ø·ÙˆØ±Ø© */
        #rulesOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.98);
            backdrop-filter: blur(15px);
            z-index: 100;
            display: flex; align-items: center; justify-content: center;
            padding: 20px; box-sizing: border-box;
            overflow-y: auto;
        }

        .rules-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(0, 242, 255, 0.3);
            border-radius: 28px;
            padding: 30px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 0 40px rgba(0, 242, 255, 0.05);
        }

        .rules-card h3 { color: var(--cyan); margin: 0 0 10px 0; text-align: center; font-size: 22px; }
        .intro-text { text-align: center; font-size: 13px; color: var(--system); margin-bottom: 20px; line-height: 1.6; }

        .section-title { font-size: 14px; font-weight: 900; margin-bottom: 10px; display: block; }
        .title-allow { color: var(--success); }
        .title-deny { color: var(--danger); }
        .title-warn { color: #facc15; }

        .rules-list { list-style: none; padding: 0; margin: 0 0 20px 0; font-size: 12.5px; line-height: 1.7; color: #cbd5e1; }
        .rules-list li { margin-bottom: 8px; position: relative; padding-right: 18px; }
        .rules-list li::before { content: "â€¢"; position: absolute; right: 0; color: var(--cyan); }

        .agree-btn {
            width: 100%; background: linear-gradient(90deg, var(--cyan), var(--purple)); 
            color: #fff; border: none; padding: 14px; border-radius: 50px; 
            font-weight: 900; cursor: pointer; font-family: 'Tajawal'; font-size: 16px;
            box-shadow: 0 10px 20px rgba(112, 0, 255, 0.2);
        }

        header { 
            padding: 15px; text-align: center; background: rgba(2, 6, 23, 0.9); 
            backdrop-filter: blur(15px); border-bottom: 1px solid rgba(0, 242, 255, 0.2);
            flex-shrink: 0; z-index: 10; position: relative;
        }
        
        .info-icon { position: absolute; right: 20px; top: 18px; color: var(--cyan); cursor: pointer; font-size: 20px; opacity: 0.7; }

        #chatBox { 
            flex: 1; overflow-y: auto; padding: 20px; display: flex; 
            flex-direction: column; gap: 15px; 
            background: radial-gradient(circle at top, #0a0a2e 0%, #020617 100%);
        }

        .msg { max-width: 85%; padding: 12px 16px; border-radius: 20px; font-size: 14px; line-height: 1.5; animation: ghostSlide 0.3s ease; }
        .msg-remote { align-self: flex-start; background: rgba(255,255,255,0.05); border: 1px solid rgba(0, 242, 255, 0.1); }
        .msg-me { align-self: flex-end; background: var(--purple); box-shadow: 0 4px 15px rgba(112, 0, 255, 0.3); }
        .msg-secret { border: 1px solid var(--danger) !important; box-shadow: 0 0 15px rgba(255, 68, 68, 0.3) !important; font-style: italic; }

        .sender { font-size: 9px; font-weight: 900; color: var(--cyan); margin-bottom: 5px; display: flex; justify-content: space-between; }
        .report-btn { cursor: pointer; color: var(--danger); font-size: 9px; opacity: 0.5; }

        .system-msg { 
            text-align: center; color: var(--cyan); font-size: 11px; padding: 12px; 
            background: rgba(0, 242, 255, 0.05); border-radius: 15px; 
            margin: 10px auto; max-width: 90%; border: 1px dashed rgba(0, 242, 255, 0.2);
            line-height: 1.6;
        }

        .input-area { 
            padding: 15px; background: #000; border-top: 1px solid rgba(255,255,255,0.1); 
            flex-shrink: 0; padding-bottom: env(safe-area-inset-bottom, 15px);
            position: relative;
        }

        .input-wrapper { display: flex; gap: 10px; width: 100%; position: relative; }
        
        /* Tooltip Ø§Ù„Ø®ÙÙŠÙ */
        .input-tooltip {
            position: absolute; top: -35px; right: 20px;
            background: var(--purple); color: #fff; font-size: 10px;
            padding: 4px 10px; border-radius: 10px;
            pointer-events: none; opacity: 0.8; animation: bounce 2s infinite;
        }

        input { flex: 1; background: #111; border: 1px solid #333; padding: 12px 18px; border-radius: 25px; color: #fff; outline: none; font-size: 16px; font-family: 'Tajawal'; }
        .send-btn { background: var(--cyan); border: none; width: 48px; height: 48px; border-radius: 50%; cursor: pointer; box-shadow: 0 0 10px var(--cyan); color: #000; }

        @keyframes ghostSlide { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    </style>
</head>
<body>

<div id="rulesOverlay">
    <div class="rules-card">
        <h3>ğŸ‘» Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø´Ø§Øª Ø§Ù„Ø£Ø´Ø¨Ø§Ø­ PRO</h3>
        <p class="intro-text">ğŸ•¯ï¸ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø´Ø§Øª Ø§Ù„Ø£Ø´Ø¨Ø§Ø­<br>Ù‡Ù†Ø§ Ù„Ø§ Ø£Ø³Ù…Ø§Ø¡ Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŒ Ù„Ø§ ÙˆØ¬ÙˆÙ‡ØŒ ÙÙ‚Ø· Ù‡Ù…Ø³Ø§Øª Ø¹Ø§Ø¨Ø±Ø©.</p>
        
        <span class="section-title title-allow">âœ… Ù…Ø³Ù…ÙˆØ­</span>
        <ul class="rules-list">
            <li>Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù† Ø§Ù„Ù…Ø´Ø§Ø¹Ø±ØŒ Ø§Ù„Ø£ÙÙƒØ§Ø±ØŒ ÙˆØ§Ù„Ø§Ø¹ØªØ±Ø§ÙØ§Øª Ø¨Ø­Ø±ÙŠØ©</li>
            <li>Ø§Ù„Ù†Ù‚Ø§Ø´ Ø§Ù„Ù‡Ø§Ø¯Ø¦ ÙˆØ§Ø­ØªØ±Ø§Ù… Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„Ø¢Ø±Ø§Ø¡</li>
            <li>Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØºÙ…ÙˆØ¶ ÙˆØ§Ù„Ø±Ù…Ø²ÙŠØ© ğŸŒ«ï¸</li>
            <li>Ø§Ù„Ø¨ÙˆØ­ Ø¨Ø¯ÙˆÙ† ÙƒØ´Ù Ù‡ÙˆÙŠØ©</li>
        </ul>

        <span class="section-title title-deny">âŒ Ù…Ù…Ù†ÙˆØ¹</span>
        <ul class="rules-list">
            <li>Ù…Ø´Ø§Ø±ÙƒØ© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª</li>
            <li>Ù†Ø´Ø± Ø±ÙˆØ§Ø¨Ø· Ø£Ùˆ Ø·Ù„Ø¨ ØªÙˆØ§ØµÙ„ Ø®Ø§Ø±Ø¬ÙŠ</li>
            <li>Ø§Ù„Ø¥Ø³Ø§Ø¡Ø©ØŒ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯ØŒ Ø£Ùˆ Ø§Ù„ØªÙ†Ù…Ø±</li>
            <li>Ù†Ø´Ø± Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù„Ø§Ø¦Ù‚ Ø£Ùˆ ØµØ§Ø¯Ù…</li>
        </ul>

        <span class="section-title title-warn">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù‡Ù…Ø©</span>
        <ul class="rules-list">
            <li>ÙŠØªÙ… ØªØºÙŠÙŠØ± Ù‡ÙˆÙŠØªÙƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙƒÙ„ 12 Ø³Ø§Ø¹Ø©</li>
            <li>Ø§Ù„ØºØ±ÙØ© ÙŠØªÙ… ØªÙ†Ø¸ÙŠÙÙ‡Ø§ Ø¯ÙˆØ±ÙŠÙ‹Ø§</li>
            <li>Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© Ù…Ø®Ø§Ù„ÙØ© Ù‚Ø¯ ÙŠØªÙ… Ø¥Ø®ÙØ§Ø¤Ù‡Ø§ Ø¯ÙˆÙ† Ø¥Ø´Ø¹Ø§Ø±</li>
        </ul>

        <p style="font-size: 11px; text-align: center; color: var(--system); margin-bottom: 20px;">
            ğŸ–¤ Ù…Ø§ ÙŠÙÙ‚Ø§Ù„ Ù‡Ù†Ø§â€¦ ÙŠØ¨Ù‚Ù‰ Ù‡Ù†Ø§. ÙƒÙ† Ø´Ø¨Ø­Ù‹Ø§ Ù„Ø·ÙŠÙÙ‹Ø§ ğŸ‘»
        </p>

        <button class="agree-btn" onclick="acceptRules()">Ø£ÙˆØ§ÙÙ‚ ÙˆØ£Ù„ØªØ²Ù… Ø¨Ø§Ù„Ù…ÙŠØ«Ø§Ù‚</button>
    </div>
</div>

<header>
    <span class="info-icon" onclick="showRules()">â“˜</span>
    <h2>ğŸ‘» Ø´Ø§Øª Ø§Ù„Ø£Ø´Ø¨Ø§Ø­ PRO</h2>
    <span id="status">ØªØ´ÙÙŠØ± Ø§Ù„Ù‡ÙˆÙŠØ©...</span>
</header>

<div id="chatBox">
    <div class="system-msg">
        ğŸ‘» ØªØ°ÙƒÙŠØ±: Ù„Ø§ Ø£Ø±Ù‚Ø§Ù…ØŒ Ù„Ø§ Ø±ÙˆØ§Ø¨Ø·ØŒ Ù„Ø§ Ø¥Ø³Ø§Ø¡Ø©. <br>
        Ø§Ù„Ù‡ÙÙˆÙŠØ© ØªØªØºÙŠØ±ØŒ ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª ØªØ¨Ù‚Ù‰.
    </div>
</div>

<div class="input-area">
    <div class="input-tooltip">Ø§Ù‡Ù…Ø³ Ø¯ÙˆÙ† ÙƒØ´Ù Ù‡ÙˆÙŠØªÙƒâ€¦</div>
    <div class="input-wrapper">
        <input type="text" id="msgInput" placeholder="Ø§Ù‡Ù…Ø³ Ø¨Ø´ÙŠØ¡..." maxlength="250" autocomplete="off">
        <button class="send-btn" id="sendBtn">âš¡</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBfOJPkWbmcJ6s29bDNysr-H0Kx-Js3Gy0",
      authDomain: "am--rewards.firebaseapp.com",
      databaseURL: "https://am--rewards-default-rtdb.firebaseio.com",
      projectId: "am--rewards",
      storageBucket: "am--rewards.firebasestorage.app",
      messagingSenderId: "744783579735",
      appId: "1:744783579735:web:45e00de9998893bbc9b112",
      measurementId: "G-CV3GLT2TTJ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const messagesRef = ref(db, "messages/room_general");

    window.acceptRules = () => {
        localStorage.setItem('ghostRulesAccepted', 'true');
        document.getElementById('rulesOverlay').style.opacity = '0';
        setTimeout(() => document.getElementById('rulesOverlay').style.display = 'none', 300);
    };

    window.showRules = () => {
        document.getElementById('rulesOverlay').style.display = 'flex';
        document.getElementById('rulesOverlay').style.opacity = '1';
    };

    if(localStorage.getItem('ghostRulesAccepted') === 'true') {
        document.getElementById('rulesOverlay').style.display = 'none';
    }

    function getIdentity() {
        const now = Date.now();
        const savedTime = localStorage.getItem('ghost_time');
        const savedName = localStorage.getItem('ghost_name');
        if (savedName && savedTime && (now - savedTime < 12 * 60 * 60 * 1000)) return savedName;
        const adjs = ["Ø§Ù„ØºØ§Ù…Ø¶", "Ø§Ù„ØªØ§Ø¦Ù‡", "Ø§Ù„ØµØ§Ù…Øª", "Ø§Ù„Ø®ÙÙŠ"];
        const names = ["Ø´Ø¨Ø­", "ÙƒÙŠØ§Ù†", "Ø·ÙŠÙ", "Ù†Ø¬Ù…"];
        const newName = names[Math.floor(Math.random()*names.length)] + " " + adjs[Math.floor(Math.random()*adjs.length)] + " #" + Math.floor(1000 + Math.random()*9000);
        localStorage.setItem('ghost_name', newName);
        localStorage.setItem('ghost_time', now);
        return newName;
    }

    const myGhostName = getIdentity();
    document.getElementById('status').innerText = "Ù‡ÙˆÙŠØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: " + myGhostName;

    let isCooling = false;

    async function send() {
        const input = document.getElementById('msgInput');
        const btn = document.getElementById('sendBtn');
        let text = input.value.trim();
        if(!text || isCooling) return;
        
        if(/(010|011|012|015)\d+/.test(text) || text.includes("@") || text.includes("http")) {
            alert("âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…ÙŠØ«Ø§Ù‚: ÙŠÙ…Ù†Ø¹ Ù†Ø´Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ø£Ùˆ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·.");
            return;
        }

        const secretKeywords = ["Ø§Ø¹ØªØ±Ø§Ù", "Ø³Ø±", "Ø®Ø¨Ø§ÙŠØ§", "Ø¨ÙˆØ­", "ğŸ¤«", "ğŸ”’", "Ø§Ø¹ØªØ±Ø§ÙØ§Øª"];
        const isSecret = secretKeywords.some(key => text.toLowerCase().includes(key));

        try {
            isCooling = true; btn.disabled = true;
            await push(messagesRef, {
                sender: myGhostName, text: text, isSecret: isSecret, timestamp: serverTimestamp()
            });
            input.value = "";
            let timer = 5;
            const cooldown = setInterval(() => {
                btn.innerText = timer; timer--;
                if(timer < 0) { clearInterval(cooldown); btn.innerText = "âš¡"; btn.disabled = false; isCooling = false; }
            }, 1000);
        } catch (e) { alert("Ø§Ù„Ø£Ø«ÙŠØ± Ù…Ø´ØºÙˆÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹!"); isCooling = false; btn.disabled = false; }
    }

    onChildAdded(messagesRef, (snapshot) => {
        const data = snapshot.val();
        const chatBox = document.getElementById('chatBox');
        const isMe = data.sender === myGhostName;
        const div = document.createElement('div');
        div.id = snapshot.key;
        div.className = `msg ${isMe ? 'msg-me' : 'msg-remote'} ${data.isSecret ? 'msg-secret' : ''}`;
        div.innerHTML = `
            <div class="sender">
                <span>${isMe ? 'Ø£Ù†Øª' : data.sender}</span>
                ${!isMe ? `<span class="report-btn" onclick="globalReport('${snapshot.key}')">ğŸš© Ø¥Ø¨Ù„Ø§Øº</span>` : ''}
            </div>
            <div class="text">${data.text}</div>
        `;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    });

    window.globalReport = (id) => {
        if(confirm("Ù‡Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù‡Ù…Ø³Ø© Ù…Ø®Ø§Ù„ÙØ© Ù„Ù„Ù…ÙŠØ«Ø§Ù‚ØŸ")) {
            document.getElementById(id)?.remove();
        }
    };

    document.getElementById('sendBtn').onclick = send;
    document.getElementById('msgInput').onkeypress = (e) => { if(e.key === 'Enter') send(); };
</script>
</body>
</html>

