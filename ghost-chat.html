<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>Ø´Ø§Øª Ø§Ù„Ø£Ø´Ø¨Ø§Ø­ PRO | Cinematic</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --cyan: #00f2ff; --purple: #7000ff; --dark: #020617; 
            --danger: #ff4444; --system: #94a3b8; --success: #10b981;
        }

        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background: #000; color: #fff; }
        body { font-family: 'Tajawal', sans-serif; display: flex; flex-direction: column; }

        /* --- Ø®Ù„ÙÙŠØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© --- */
        .video-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden;
        }
        .video-background video {
            min-width: 100%; min-height: 100%; width: auto; height: auto;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            object-fit: cover; filter: brightness(0.4) blur(1px);
        }
        .video-overlay {
            position: absolute; inset: 0; 
            background: linear-gradient(to bottom, rgba(2,6,23,0.3), rgba(2,6,23,0.8));
        }

        /* --- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© --- */
        header { 
            padding: 15px; text-align: center; 
            background: rgba(2, 6, 23, 0.7); backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(0, 242, 255, 0.1); z-index: 10;
        }

        #chatBox { 
            flex: 1; overflow-y: auto; padding: 20px; display: flex; 
            flex-direction: column; gap: 12px; background: transparent;
        }

        /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ --- */
        .msg { 
            max-width: 80%; padding: 12px 16px; border-radius: 20px; font-size: 14px; 
            backdrop-filter: blur(8px); animation: msgIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        .msg-remote { align-self: flex-start; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.05); border-bottom-right-radius: 4px; }
        .msg-me { align-self: flex-end; background: rgba(112, 0, 255, 0.5); border: 1px solid rgba(112, 0, 255, 0.3); border-bottom-left-radius: 4px; }
        .msg-secret { border: 1px solid var(--danger) !important; box-shadow: 0 0 15px rgba(255, 68, 68, 0.2); }

        .sender { font-size: 10px; font-weight: 900; color: var(--cyan); margin-bottom: 5px; display: flex; justify-content: space-between; }
        .report-btn { cursor: pointer; color: var(--danger); font-size: 9px; opacity: 0.6; }

        /* --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ --- */
        .input-area { 
            padding: 15px; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-bottom: calc(15px + env(safe-area-inset-bottom));
        }

        .input-wrapper { display: flex; gap: 10px; max-width: 600px; margin: 0 auto; }
        input { 
            flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); 
            padding: 14px 20px; border-radius: 30px; color: #fff; outline: none; font-size: 16px;
        }
        .send-btn { 
            background: var(--cyan); border: none; width: 50px; height: 50px; 
            border-radius: 50%; cursor: pointer; font-size: 20px; transition: 0.3s;
        }
        .send-btn:disabled { opacity: 0.5; filter: grayscale(1); }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ --- */
        #rulesOverlay {
            position: fixed; inset: 0; background: rgba(2,6,23,0.96); backdrop-filter: blur(20px);
            z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        .rules-card { background: rgba(255,255,255,0.03); border: 1px solid var(--cyan); border-radius: 25px; padding: 25px; max-width: 400px; text-align: center; }
        .agree-btn { width: 100%; background: var(--cyan); color: #000; border: none; padding: 15px; border-radius: 50px; font-weight: 900; cursor: pointer; margin-top: 15px; }

        @keyframes msgIn { from { opacity: 0; transform: translateY(15px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
    </style>
</head>
<body>

<div class="video-background">
    <video autoplay muted loop playsinline id="bgVideo">
        <source src="https://assets.mixkit.co/videos/preview/mixkit-forest-stream-in-the-dark-12165-large.mp4" type="video/mp4">
    </video>
    <div class="video-overlay"></div>
</div>

<div id="rulesOverlay">
    <div class="rules-card">
        <h3 style="color:var(--cyan)">ğŸ‘» Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ø£Ø´Ø¨Ø§Ø­</h3>
        <p style="font-size:13px; color:var(--system)">ÙŠÙ…Ù†Ø¹ Ù†Ø´Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…ØŒ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·ØŒ Ø£Ùˆ Ø§Ù„Ø¥Ø³Ø§Ø¡Ø©. Ù‡Ù…Ø³ØªÙƒ Ù…Ø¬Ù‡ÙˆÙ„Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ØªÙ…Ø§Ù…Ø§Ù‹.</p>
        <button class="agree-btn" onclick="acceptRules()">Ø£ÙˆØ§ÙÙ‚ ÙˆØ£Ù„ØªØ²Ù…</button>
    </div>
</div>

<header>
    <h2 style="margin:0; font-size:18px; letter-spacing:1px;">GHOST CHAT <span style="color:var(--cyan)">PRO</span></h2>
    <span id="status" style="font-size:10px; color:var(--system)">Ø¬Ø§Ø±ÙŠ ØªØ´ÙÙŠØ± Ø§Ù„ÙƒÙŠØ§Ù†...</span>
</header>

<div id="chatBox"></div>

<div class="input-area">
    <div class="input-wrapper">
        <input type="text" id="msgInput" placeholder="Ø§Ù‡Ù…Ø³ Ø¨Ø´ÙŠØ¡ Ù„Ù„Ø¸Ù„Ø§Ù…..." maxlength="200" autocomplete="off">
        <button class="send-btn" id="sendBtn">âœ¦</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, serverTimestamp, query, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBfOJPkWbmcJ6s29bDNysr-H0Kx-Js3Gy0",
      authDomain: "am--rewards.firebaseapp.com",
      databaseURL: "https://am--rewards-default-rtdb.firebaseio.com",
      projectId: "am--rewards",
      storageBucket: "am--rewards.firebasestorage.app",
      messagingSenderId: "744783579735",
      appId: "1:744783579735:web:45e00de9998893bbc9b112"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const messagesRef = ref(db, "messages/room_cinematic");

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
    const getIdentity = () => {
        const names = ["Ø·ÙŠÙ", "ÙƒÙŠØ§Ù†", "Ø³Ø±Ø§Ø¨", "Ø¸Ù„", "Ù†ÙˆØ±"];
        const adjs = ["Ø§Ù„Ø®ÙÙŠ", "Ø§Ù„ØµØ§Ù…Øª", "Ø§Ù„Ø¹Ø§Ø¨Ø±", "Ø§Ù„ØºØ§Ù…Ø¶"];
        return `${names[Math.floor(Math.random()*names.length)]} ${adjs[Math.floor(Math.random()*adjs.length)]} #${Math.floor(1000+Math.random()*9000)}`;
    };

    if(!localStorage.getItem('ghost_name')) localStorage.setItem('ghost_name', getIdentity());
    const myName = localStorage.getItem('ghost_name');
    document.getElementById('status').innerText = "Ù‡ÙˆÙŠØªÙƒ: " + myName;

    // Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯
    window.acceptRules = () => {
        localStorage.setItem('ghost_rules_final', 'true');
        document.getElementById('rulesOverlay').style.display = 'none';
    };
    if(localStorage.getItem('ghost_rules_final')) acceptRules();

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ±Ø©
    let isCooling = false;
    async function send() {
        const input = document.getElementById('msgInput');
        const text = input.value.trim();
        if(!text || isCooling) return;

        // ÙÙ„ØªØ±Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·
        if(/(010|011|012|015)\d+/.test(text) || text.includes("http") || text.includes("www")) {
            alert("âš ï¸ Ø§Ù„Ù…ÙŠØ«Ø§Ù‚ ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù….");
            return;
        }

        isCooling = true;
        document.getElementById('sendBtn').disabled = true;

        try {
            await push(messagesRef, {
                sender: myName,
                text: text,
                isSecret: text.includes("Ø³Ø±") || text.includes("Ø§Ø¹ØªØ±Ø§Ù"),
                timestamp: serverTimestamp()
            });
            input.value = "";
        } finally {
            setTimeout(() => {
                isCooling = false;
                document.getElementById('sendBtn').disabled = false;
            }, 3000);
        }
    }

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Ø¢Ø®Ø± 50)
    const q = query(messagesRef, limitToLast(50));
    onChildAdded(q, (snap) => {
        const data = snap.val();
        const chatBox = document.getElementById('chatBox');
        const isMe = data.sender === myName;
        const div = document.createElement('div');
        div.className = `msg ${isMe ? 'msg-me' : 'msg-remote'} ${data.isSecret ? 'msg-secret' : ''}`;
        div.innerHTML = `
            <div class="sender">
                <span>${isMe ? 'Ø£Ù†Øª' : data.sender}</span>
                ${!isMe ? `<span class="report-btn" onclick="this.parentElement.parentElement.style.display='none'">ğŸš©</span>` : ''}
            </div>
            <div class="text">${data.text}</div>
        `;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    });

    document.getElementById('sendBtn').onclick = send;
    document.getElementById('msgInput').onkeypress = (e) => e.key === 'Enter' && send();
</script>
</body>
</html>
