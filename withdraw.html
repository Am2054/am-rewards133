<!DOCTYPE html><html lang="ar" dir="rtl"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>سحب الأرباح | Am Rewards</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background-color: #111;
      color: #fff;
      padding: 20px;
    }h1 {
  text-align: center;
  margin-bottom: 30px;
}

.form-group {
  margin-bottom: 20px;
}

label {
  display: block;
  margin-bottom: 5px;
}

input,
select,
button {
  width: 100%;
  padding: 10px;
  border: none;
  border-radius: 8px;
  margin-bottom: 10px;
  font-size: 16px;
}

input,
select {
  background-color: #222;
  color: #fff;
}

button {
  background-color: #0f9d58;
  color: white;
  cursor: pointer;
}

button:hover {
  background-color: #0b7e46;
}

.balance {
  text-align: center;
  margin-bottom: 20px;
}

.error {
  color: red;
  text-align: center;
}

  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBszYz...",
      authDomain: "am--rewards.firebaseapp.com",
      projectId: "am--rewards",
      storageBucket: "am--rewards.appspot.com",
      messagingSenderId: "3697...",
      appId: "1:3697...:web:..."
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();let userEmail = "";
auth.onAuthStateChanged(async (user) => {
  if (user) {
    userEmail = user.email;
    const userDoc = await db.collection("users").doc(user.uid).get();
    const points = userDoc.exists ? userDoc.data().points || 0 : 0;
    document.getElementById("points").innerText = points + " نقطة";
    document.getElementById("pointsHidden").value = points;
  } else {
    window.location.href = "login.html";
  }
});

async function submitWithdrawal() {
  const method = document.getElementById("method").value;
  const number = document.getElementById("walletNumber").value;
  const points = parseInt(document.getElementById("pointsHidden").value);
  const minPoints = 357;

  if (!number || points < minPoints) {
    document.getElementById("error").innerText = "يجب إدخال رقم محفظة وأن يكون لديك على الأقل 357 نقطة.";
    return;
  }

  const amount = (points * 0.07).toFixed(2);
  await db.collection("withdrawRequests").add({
    email: userEmail,
    method,
    number,
    points,
    amount,
    timestamp: new Date()
  });

  alert("تم إرسال طلب السحب بنجاح");
  window.location.reload();
}

  </script>
</head><body>
  <h1>سحب الأرباح</h1>
  <div class="balance">
    <p>رصيدك الحالي: <span id="points">جاري التحميل...</span></p>
  </div>
  <div class="form-group">
    <label for="method">اختر وسيلة السحب:</label>
    <select id="method">
      <option value="vodafone">فودافون كاش</option>
      <option value="etisalat">اتصالات كاش</option>
      <option value="orange">أورنج كاش</option>
    </select>
  </div>
  <div class="form-group">
    <label for="walletNumber">رقم المحفظة:</label>
    <input type="text" id="walletNumber" placeholder="أدخل رقم الهاتف المرتبط بالمحفظة">
  </div>
  <input type="hidden" id="pointsHidden" value="0">
  <div class="form-group">
    <button onclick="submitWithdrawal()">طلب سحب</button>
  </div>
  <p class="error" id="error"></p>
</body></html>
