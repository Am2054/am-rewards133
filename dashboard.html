<!DOCTYPE html>    
<html lang="ar" dir="rtl">      
<head>      
  <meta charset="utf-8" />      
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Am Rewards</title>      
  <meta name="viewport" content="width=device-width,initial-scale=1" />      
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Montserrat:wght@900&display=swap" rel="stylesheet">      
  <style>      
    :root{      
      --primary:#17e7b3;      
      --primary-dark:#12886b;      
      --bg-1:#082032;      
      --bg-2:#001b2e;      
      --glass:rgba(255,255,255,0.06);      
      --text:#e6eef6;      
      --muted:#9aa4b2;      
      --gold:#f6b93b;      
      --danger:#ff5f5f;      
      --secondary:#1fb6ff;      
      --surface:#091826;      
      --shadow:0 10px 40px rgba(7,22,34,0.6), 0 2px 8px rgba(31,182,255,0.06);      
    }      
    *{box-sizing:border-box}      
    html,body{height:100%}      
    body{      
      margin:0;padding:0; font-family:"Cairo",sans-serif; color:var(--text);      
      background:linear-gradient(135deg,var(--bg-1),var(--bg-2)); overflow-y:auto;      
    }      
    .bg-animated{      
      position:fixed;inset:0;z-index:-2;      
      background:linear-gradient(120deg,#062f3f, #0c1b3a 40%, #05202b 70%);      
      animation: moveBg 12s linear infinite; opacity:0.95;      
    }      
    @keyframes moveBg { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }      
    .wrap{max-width:520px;margin:28px auto;padding:18px;}      
    .card{      
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));      
      border-radius:16px; padding:16px; box-shadow:var(--shadow); border:1px solid var(--glass); backdrop-filter: blur(6px);      
    }      
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}      
    .brand{display:flex;gap:12px;align-items:center}      
    .logo{      
      width:58px;height:58px;border-radius:14px; background:linear-gradient(135deg,var(--primary),var(--secondary));      
      display:flex;align-items:center;justify-content:center; color:#08121a;font-family:"Montserrat",sans-serif;font-weight:900;font-size:22px;      
    }      
    .headline h1{margin:0;font-size:20px;color:var(--primary)}      
    .headline .sub{font-size:13px;color:var(--muted)}      
    .profile { display:flex;gap:15px;align-items:center;margin-top:12px; animation: fadeUp .65s ease both; flex-direction: row-reverse; }      
    .avatar{      
      width:72px;height:72px;border-radius:16px; background:linear-gradient(135deg,#fff2,#fff0);      
      display:flex;align-items:center;justify-content:center;color:#09121a;font-weight:900;font-size:26px;      
    }      
    .profile-info{flex:1;text-align:right}    
    .profile-actions{display:flex;gap:8px;margin-top:10px;justify-content: flex-end;}     
    .btn{ padding:9px 14px;border-radius:12px;border:0;cursor:pointer;font-weight:800; display:inline-flex;gap:8px;align-items:center; transition: 0.2s; }      
    .btn.ghost{background:transparent;border:1.5px solid var(--glass);color:var(--muted)}      
    .btn.danger{background:var(--danger);color:#fff;}  
    .balance-wrap{display:flex;gap:10px;margin-top:14px;animation: fadeUp .75s .08s both}      
    .balance-card{      
      flex:1;padding:16px;border-radius:14px;background:rgba(255,255,255,0.02); border:1px solid var(--glass);      
      display: flex; flex-direction: column; align-items: flex-end;    
    }      
    .bal-value{font-size:30px;font-weight:900;font-family:"Montserrat",sans-serif;}     
    .progress-card{      
      margin-top: 14px; padding:16px; display:flex; align-items:center; justify-content:space-between; flex-direction: row-reverse; 
      background:rgba(31,182,255,0.05); border:1px solid var(--glass); border-radius: 16px; position: relative; overflow: hidden;
    }
    .progress-card::before {
      content: ''; position: absolute; inset: 0; background: linear-gradient(90deg, rgba(23,231,179,0.15), transparent);
      width: var(--progress-pct, 0%); transition: width 0.8s ease; z-index: 0;
    }
    .circle-wrap{ width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center; z-index: 1; position: relative; }
    .actions{display:flex;flex-direction:column;gap:10px;margin-top:14px;}
    .action-btn{
      display:flex;align-items:center;justify-content:space-between;padding:14px;border-radius:12px;
      background:rgba(255,255,255,0.03); border:1px solid var(--glass); text-decoration:none; color:var(--text);
    }
    .stats-row{display:flex;gap:10px;margin-top:12px}
    .stat-card{flex:1;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid var(--glass);text-align:center}
    @keyframes fadeUp { from {opacity:0; transform: translateY(12px)} to {opacity:1; transform: translateY(0)} }
    .toast { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: #000; padding: 12px 20px; border-radius: 10px; display: none; z-index: 1000; }
  </style>      
</head>      
<body>      
  <div class="bg-animated"></div>      
  <div class="wrap">      
    <header>      
      <div class="brand">      
        <div class="logo">AM</div>      
        <div class="headline"><h1>Am Rewards</h1><div class="sub">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ</div></div>      
      </div>      
      <button id="refreshBtnTop" class="btn ghost">ğŸ”„</button>      
    </header>    

    <div class="card profile">    
      <div class="avatar" id="avatar">A</div>    
      <div class="profile-info">    
          <h3 id="userName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>    
          <p id="userEmail">---</p>    
          <p id="userRefCode" style="color:var(--primary); font-weight: 700;">ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©: ---</p>    
          <div class="profile-actions"><button id="logoutBtn" class="btn danger">Ø®Ø±ÙˆØ¬</button></div>    
      </div>    
    </div>    

    <div class="card balance-wrap">      
      <div class="balance-card">      
        <div style="font-size:12px;color:var(--muted)">Ù†Ù‚Ø§Ø·Ùƒ</div>      
        <div class="bal-value" id="userPoints">0</div>      
        <div id="pointsEgp" style="color:var(--primary)">0.00 Ø¬</div>      
      </div>        
      <div class="balance-card" style="border-color: var(--gold)">    
          <div style="font-size:12px;color:var(--gold)">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³Ø­Ø¨</div>    
          <div class="bal-value" style="color:var(--gold)" id="userBalanceEgp">0.00</div>    
          <div style="font-size:10px;color:var(--muted)">1 Ù†Ù‚Ø·Ø© = 0.07 Ø¬</div>    
      </div>    
    </div>      

    <div class="card progress-card" id="progressCard">    
        <div class="circle-wrap" id="circleWrap">
            <div style="background:var(--bg-1); width:65px; height:65px; border-radius:50%; display:flex; align-items:center; justify-content:center; flex-direction:column;">
                <span id="progressPercent" style="font-weight:900; color:var(--primary)">0%</span>
            </div>
        </div>    
        <div class="progress-info" style="z-index:1; text-align:right">    
            <div style="color:var(--muted); font-size:14px">Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ… (1,000 Ù†Ù‚Ø·Ø©)</div>    
            <div id="progressLbl" style="font-size:22px; font-weight:900; color:var(--secondary)">0 / 1000</div>    
        </div>    
    </div>    

    <div class="actions">      
      <a class="action-btn" href="tasks.html"><span>ğŸ“ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</span><b>Ø§Ø¨Ø¯Ø£</b></a>      
      <a class="action-btn" href="referrals.html"><span>ğŸ‘¥ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</span><b>Ø¹Ø±Ø¶</b></a>      
      <a class="action-btn" href="withdraw.html" style="border-color: var(--primary)"><span>ğŸ’¸ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</span><b>Ø³Ø­Ø¨</b></a>      
    </div>      

    <div class="stats-row">      
      <div class="stat-card"><div id="pointsToday" style="font-weight:900">0</div><div style="font-size:11px; color:var(--muted)">Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…</div></div>      
      <div class="stat-card"><div id="totalWithdrawn" style="font-weight:900">0 Ø¬</div><div style="font-size:11px; color:var(--muted)">Ù…Ø³Ø­ÙˆØ¨Ø§Øª</div></div>      
      <div class="stat-card"><div id="referralPoints" style="font-weight:900">0</div><div style="font-size:11px; color:var(--muted)">Ù…Ù† Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ</div></div>      
    </div>      
    <footer>Â© 2025 Am Rewards</footer>    
  </div>      
  <div id="toast" class="toast"></div>      

  <script type="module">      
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";      
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";      
    import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";      

    const firebaseConfig = { apiKey: "AIzaSyBfOJPkWbmcJ6s29bDNysr-H0Kx-Js3Gy0", authDomain: "am--rewards.firebaseapp.com", projectId: "am--rewards" };      
    const app = initializeApp(firebaseConfig);      
    const auth = getAuth(app);      
    const db = getFirestore(app);      
    const POINT_VALUE = 0.07;      

    // Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
    function animateValue(id, start, end, duration) {
        const obj = document.getElementById(id);
        if (!obj) return;
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
            if (progress < 1) window.requestAnimationFrame(step);
        };
        window.requestAnimationFrame(step);
    }

    let lastPoints = 0;

    onAuthStateChanged(auth, (user) => {      
      if (!user) return location.href = 'index.html';      
      
      onSnapshot(doc(db, 'users', user.uid), (snap) => {    
        if (!snap.exists()) return;
        const d = snap.data();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ
        document.getElementById('userName').textContent = d.name || 'Ù…Ø³ØªØ®Ø¯Ù…';
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userRefCode').textContent = `ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©: ${d.referralCode || '---'}`;
        document.getElementById('avatar').textContent = (d.name || 'A')[0].toUpperCase();

        // Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
        const pts = Number(d.points || 0);
        animateValue("userPoints", lastPoints, pts, 1000);
        lastPoints = pts;

        const egp = (pts * POINT_VALUE).toFixed(2);
        document.getElementById('pointsEgp').textContent = egp + ' Ø¬';
        document.getElementById('userBalanceEgp').textContent = egp;

        const ptsToday = Math.max(pts - (d.previousPoints || 0), 0);
        document.getElementById('pointsToday').textContent = ptsToday;
        document.getElementById('totalWithdrawn').textContent = (d.totalWithdrawn || 0) + ' Ø¬';
        document.getElementById('referralPoints').textContent = d.referralPoints || 0;

        // Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ
        const pct = Math.min(Math.round((ptsToday / 1000) * 100), 100);
        document.getElementById('progressPercent').textContent = pct + '%';
        document.getElementById('progressLbl').textContent = `${ptsToday} / 1000`;
        document.getElementById('circleWrap').style.background = `conic-gradient(var(--primary) ${pct}%, var(--glass) 0)`;
        document.getElementById('progressCard').style.setProperty('--progress-pct', pct + '%');
      });    
    });

    document.getElementById('logoutBtn').onclick = () => signOut(auth).then(() => location.href = 'index.html');
    document.getElementById('refreshBtnTop').onclick = () => {
        document.getElementById('toast').style.display = 'block';
        document.getElementById('toast').textContent = 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø© Ù„Ø­Ø¸ÙŠØ§Ù‹ âš¡';
        setTimeout(() => document.getElementById('toast').style.display = 'none', 2000);
    };
  </script>    
</body>
</html>
