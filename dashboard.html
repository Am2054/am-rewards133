<!DOCTYPE html>    
<html lang="ar" dir="rtl">      
<head>      
  <meta charset="utf-8" />      
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Am Rewards</title>      
  <meta name="viewport" content="width=device-width,initial-scale=1" />      
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Montserrat:wght@900&display=swap" rel="stylesheet">      
  <style>      
    :root{      
      --primary:#17e7b3;      
      --primary-dark:#12886b;      
      --bg-1:#082032;      
      --bg-2:#001b2e;      
      --glass:rgba(255,255,255,0.06);      
      --text:#e6eef6;      
      --muted:#9aa4b2;      
      --gold:#f6b93b;      
      --danger:#ff5f5f;      
      --secondary:#1fb6ff;      
      --surface:#091826;      
      --shadow:0 10px 40px rgba(7,22,34,0.6), 0 2px 8px rgba(31,182,255,0.06);      
    }      
    *{box-sizing:border-box}      
    html,body{height:100%}      
    body{      
      margin:0;padding:0;      
      font-family:"Cairo",sans-serif;      
      color:var(--text);      
      -webkit-font-smoothing:antialiased;      
      -moz-osx-font-smoothing:grayscale;      
      background:linear-gradient(135deg,var(--bg-1),var(--bg-2));      
      overflow-y:auto;      
    }      
    .bg-animated{      
      position:fixed;inset:0;z-index:-2;      
      background:linear-gradient(120deg,#062f3f, #0c1b3a 40%, #05202b 70%);      
      animation: moveBg 12s linear infinite;      
      opacity:0.95;      
    }      
    @keyframes moveBg {      
      0%{background-position:0% 50%}      
      50%{background-position:100% 50%}      
      100%{background-position:0% 50%}      
    }      
    .wrap{max-width:520px;margin:28px auto;padding:18px;}      
    .card{      
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));      
      border-radius:16px;      
      padding:16px;      
      box-shadow:var(--shadow);      
      border:1px solid var(--glass);      
      backdrop-filter: blur(6px);      
    }      
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}      
    .brand{display:flex;gap:12px;align-items:center}      
    .logo{      
      width:58px;height:58px;border-radius:14px;      
      background:linear-gradient(135deg,var(--primary),var(--secondary));      
      display:flex;align-items:center;justify-content:center;      
      color:#08121a;font-family:"Montserrat",sans-serif;font-weight:900;font-size:22px;box-shadow:0 6px 22px rgba(23,231,179,0.12);      
    }      
    .headline h1{margin:0;font-size:20px;color:var(--primary)}      
    .headline .sub{margin-top:4px;font-size:13px;color:var(--muted)}      
    .profile {    
      display:flex;gap:15px;align-items:center;margin-top:12px;      
      animation: fadeUp .65s ease both;      
      flex-direction: row-reverse; /* ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± */    
    }      
    .avatar{      
      width:72px;height:72px;border-radius:16px;      
      background:linear-gradient(135deg,#fff2,#fff0);      
      display:flex;align-items:center;justify-content:center;color:#09121a;font-weight:900;font-size:26px;      
      box-shadow:0 8px 30px rgba(0,0,0,0.4);      
      flex-shrink:0;      
    }      
    .profile-info{flex:1;text-align:right}    
    .profile-info h3{margin:0;font-size:19px}      
    .profile-info p{margin:4px 0 0 0;color:var(--muted);font-size:13px;word-break:break-all}      
    .profile-actions{display:flex;gap:8px;margin-top:10px;justify-content: flex-end;} /* ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */    
    .btn{      
      padding:9px 14px;border-radius:12px;border:0;cursor:pointer;font-weight:800;font-size:13px;      
      display:inline-flex;gap:8px;align-items:center;justify-content:center;      
      transition: background 0.2s, box-shadow 0.2s;    
    }      
    .btn.ghost{background:transparent;border:1.5px solid var(--glass);color:var(--muted)}      
    .btn.ghost:hover{background:var(--glass)}    
    .btn.primary{background:linear-gradient(90deg,var(--primary),var(--secondary));color:#07101a;box-shadow:0 8px 20px rgba(31,182,255,0.08)}      
    .btn.danger{background:var(--danger);color:#fff;box-shadow:0 4px 15px rgba(255,95,95,0.3)} /* Ø²Ø± Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø®Ø±ÙˆØ¬ */  .balance-wrap{display:flex;gap:10px;align-items:stretch;margin-top:14px;animation: fadeUp .75s .08s both}      
.balance-card{      
  flex:1;padding:16px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));      
  border:1px solid var(--glass);      
  display: flex;    
  flex-direction: column;    
  justify-content: center;    
  align-items: flex-end;    
}      
.bal-title{font-size:13px;color:var(--muted);margin-bottom:6px;text-align:right}      
.bal-value{font-size:34px;font-weight:900;line-height:1;margin:0;font-family:"Montserrat",sans-serif;} /* Ø®Ø· Ø£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ø§Ù‹ */    
.bal-egp{color:var(--gold);font-weight:700;margin-top:6px;font-size:14px}      /* --- ØªØ­Ø³ÙŠÙ† Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ --- /
.progress-card{
margin-top: 14px;
padding:16px; / Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ /
display:flex;
align-items:center;
justify-content:space-between;
flex-direction: row-reverse; / Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± */
background:linear-gradient(90deg, rgba(31,182,255,0.04), rgba(23,231,179,0.02));
border:1px solid var(--glass);
border-radius: 16px;
animation: fadeUp .75s .12s both;
position: relative;
overflow: hidden;
}
.progress-info {
flex: 1;
text-align: right;
align-self: center;
z-index: 1;
}
.progress-info .title {
font-size: 15px;
color: var(--muted);
margin-bottom: 4px;
}
.progress-info .value {
font-size: 28px;
font-weight: 900;
color: var(--secondary);
font-family:"Montserrat",sans-serif;
}
.progress-info .goal-text {
font-size: 13px;
color: var(--primary-dark);
font-weight: 700;
margin-top: 4px;
}

/* Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø£ÙÙ‚ÙŠ Ù„ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø¬Ù…Ø§Ù„ÙŠØ© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù‡Ø§ØªÙ /
.progress-card::before {
content: '';
position: absolute;
inset: 0;
background: linear-gradient(90deg, rgba(23,231,179,0.2), rgba(31,182,255,0.05));
width: var(--progress-pct, 0%); / ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JS */
transition: width 0.5s ease-out;
z-index: 0;
}

.circle-wrap{
width:94px;height:94px;border-radius:50%;display:flex;align-items:center;justify-content:center;
box-shadow:inset 0 2px 6px rgba(0,0,0,0.4);
background: linear-gradient(180deg, rgba(0,0,0,0.18), rgba(255,255,255,0.02));
text-align:center;
flex-shrink:0;
z-index: 1;
}
.circle-inner{
width:80px;height:80px;border-radius:50%;
background:var(--surface);
display:flex;align-items:center;justify-content:center;
flex-direction: column;
}
.circle .num{font-weight:900;font-size:18px;color:var(--primary);font-family:"Montserrat",sans-serif;}
.circle .lbl{display:block;font-size:11px;color:var(--muted);margin-top:4px}
/* --- Ù†Ù‡Ø§ÙŠØ© ØªØ­Ø³ÙŠÙ† Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ --- */

.actions{display:flex;flex-direction:column;gap:10px;margin-top:14px;animation: fadeUp .9s .16s both}
.action-btn{
display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:12px;
background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
border:1px solid var(--glass);cursor:pointer;text-decoration:none;color:var(--text);font-weight:800;
box-shadow:0 6px 24px rgba(2,6,23,0.25);
transition: transform 0.15s, box-shadow 0.15s;
}
.action-btn:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(2,6,23,0.35);}
.action-left{display:flex;align-items:center;gap:12px}
.action-ico{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(90deg,var(--primary),var(--secondary));color:#08121a;font-weight:900}
.action-title{font-size:15px}
.action-sub{font-size:12px;color:var(--muted);margin-top:3px;font-weight:600}
.stats-row{display:flex;gap:10px;margin-top:12px}
.stat-card{flex:1;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid var(--glass);text-align:center}
.stat-number{font-weight:900;font-size:18px;font-family:"Montserrat",sans-serif;}
.stat-label{font-size:12px;color:var(--muted);margin-top:6px}
footer{margin:22px 0 18px 0;text-align:center;color:rgba(255,255,255,0.14);font-size:13px}
@keyframes fadeUp {
from {opacity:0; transform: translateY(12px)}
to {opacity:1; transform: translateY(0)}
}
@media(max-width:480px){
.wrap{padding:12px}
.profile{gap:10px; flex-direction: row-reverse !important; align-items: center !important;} /* ØªØ¹Ø¯ÙŠÙ„: Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ù…Ø­Ø§Ø°Ø§Ø© Ø¹Ø§Ø¯ÙŠØ© ÙÙŠ Ø§Ù„Ù‡Ø§ØªÙ /
.profile-info{text-align: right !important;}
.profile-actions{justify-content: flex-end;}
.balance-wrap{flex-direction:row;align-items:center; gap: 10px;}
.balance-card{padding: 12px;}
.progress-card{padding: 14px; flex-direction: row-reverse; gap: 15px;}
/ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø£ÙÙ‚ÙŠ */
.circle-wrap{display: none;}
.progress-info .title {font-size: 14px;}
.progress-info .value {font-size: 24px;}
.progress-info .goal-text {font-size: 12px;}

.bal-value{font-size:26px}
.action-ico{width:40px;height:40}
.logo{width:50px;height:50;font-size:18px}
}
/* Toast Styles */
.toast {
min-width: 140px;
max-width: 320px;
padding: 13px 22px;
border-radius: 13px;
color: #fff;
font-weight: 800;
text-align: center;
position: fixed;
right: 22px;
bottom: 38px;
opacity: 0;
pointer-events: none;
transition: opacity 0.2s, transform 0.3s;
z-index: 999;
box-shadow: 0 8px 30px #0004, 0 2px 8px #0002;
font-size: 16px;
transform: translateY(30px);
background: linear-gradient(90deg,#16a34a,#34d399);
}
.toast.error {
background: linear-gradient(90deg,#f97316,#fb7185) !important;
}
.toast.show {
opacity: 1;
pointer-events: auto;
transform: translateY(0);
}
@media (max-width: 600px) {
.toast {
right: 50%;
transform: translateX(50%) translateY(30px);
left: auto;
bottom: 18px;
font-size: 13px;
padding: 9px 12px;
min-width: 90px;
max-width: 96vw;
}
.toast.show {
transform: translateX(50%) translateY(0);
}
}
  </style>      
</head>      
<body>      
  <div class="bg-animated" aria-hidden="true"></div>      
  <div class="wrap">      
    <header>      
      <div class="brand">      
        <div class="logo">AM</div>      
        <div class="headline">      
          <h1>Am Rewards</h1>      
          <div class="sub">Ø³Ø§Ø±Ø¹ Ø¨Ø¬Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø· â€” Ø§Ù„Ø«Ù‚Ø© ÙˆØ§Ù„Ø£Ù…Ø§Ù† Ø£ÙˆÙ„Ù‹Ø§</div>      
        </div>      
      </div>      
      <div style="text-align:left">      
        <button id="refreshBtnTop" class="btn ghost" title="ØªØ­Ø¯ÙŠØ«">    
          <svg viewBox="0 0 24 24" fill="none" style="width:16px;height:16px;stroke-width:2.5"><path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C14.1599 3 16.2162 3.73719 17.8856 5.03509" stroke="currentColor" stroke-linecap="round"/><path d="M17 3V7H21" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/></svg>    
        </button>      
      </div>      
    </header>    
    <div class="card profile">    
      <div class="avatar" id="avatar">A</div>    
      <div class="profile-info">    
          <h3 id="userName">Ù…Ø³ØªØ®Ø¯Ù…</h3>    
          <p id="userEmail">â€”</p>    
          <p id="userRefCode" style="font-size:12px; color:var(--primary); margin: 0 0 4px 0; font-weight: 700;">ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©: â€”</p>    
          <div class="profile-actions">    
              <button id="logoutBtn" class="btn danger">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>    
          </div>    
      </div>    
    </div>    
    <div class="card balance-wrap">      
      <div class="balance-card">      
        <div class="bal-title">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù†Ù‚Ø§Ø·)</div>      
        <div class="bal-value" id="userPoints">0</div>      
        <div class="bal-egp" style="color: var(--primary); font-size: 14px; margin-top: 6px;" id="pointsEgp">0.00 Ø¬</div>      
      </div>        
      <div class="balance-card" style="background: linear-gradient(180deg, rgba(246, 185, 59, 0.1), rgba(246, 185, 59, 0.05));">    
          <div class="bal-title" style="color: var(--gold);">Ø±ØµÙŠØ¯ÙŠ Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡ Ø§Ù„Ù…ØµØ±ÙŠ</div>    
          <div class="bal-value" style="color: var(--gold);" id="userBalanceEgp">0.00</div>    
          <div class="bal-egp" style="color: var(--muted); font-weight: 600; margin-top: 6px;">1 Ù†Ù‚Ø·Ø© = 0.07 Ø¬</div>    
      </div>    
    </div>      
    <div class="card progress-card" id="progressCard">    
        <div class="circle-wrap" id="circleWrap">    
            <div class="circle-inner">    
                <span class="num" id="progressPercent">0%</span>    
                <span class="lbl">Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…</span>    
            </div>    
        </div>    
        <div class="progress-info">    
            <div class="title">ØªÙ‚Ø¯Ù…Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù†Ø­Ùˆ Ø§Ù„Ù‡Ø¯Ù</div>    
            <div class="value" id="progressLbl">0 / 1,000</div>    
            <div class="goal-text">Ù„ØªØ­Ù‚ÙŠÙ‚ Ù‡Ø¯Ù 1,000 Ù†Ù‚Ø·Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§</div>    
        </div>    
    </div>    
 <div class="actions">      
  <a class="action-btn" href="tasks.html">      
    <div class="action-left">      
      <div class="action-ico">ğŸ“</div>      
      <div>      
        <div class="action-title">Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª</div>      
        <div class="action-sub">Ø£ÙƒÙ…Ù„ Ù…Ù‡Ø§Ù…Ùƒ Ù„Ø±Ø¨Ø­ Ù†Ù‚Ø§Ø·</div>      
      </div>      
    </div>      
    <div style="color:var(--muted);font-weight:800">Ø§Ø°Ù‡Ø¨</div>      
  </a>   
</div> 
  <div class="action-title">Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</div>      
            <div class="action-sub">Ø§Ø¯Ø¹Ù Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ ÙˆØ§ÙƒØ³Ø¨ Ù†Ø³Ø¨Ø©</div>      
          </div>      
        </div>      
        <div style="color:var(--muted);font-weight:800">Ø¹Ø±Ø¶</div>      
      </a>        
      <a class="action-btn" href="mailto:support@am-rewards.com" target="_blank" style="border-color: rgba(255, 95, 95, 0.3);">      
        <div class="action-left">      
          <div class="action-ico" style="background:linear-gradient(90deg,var(--danger),#ff8a8a)">ğŸ’¬</div>      
          <div>      
            <div class="action-title">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</div>      
            <div class="action-sub">Ø¯Ø¹Ù… ÙÙ†ÙŠ Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¹Ø©</div>      
          </div>      
        </div>      
        <div style="color:var(--muted);font-weight:800">Ø¯Ø¹Ù…</div>      
      </a>      
      <a class="action-btn" href="withdraw.html">      
        <div class="action-left">      
          <div class="action-ico" style="background:linear-gradient(90deg,#1fb6ff,#5fffb6)">ğŸ’¸</div>      
          <div>      
            <div class="action-title">Ø§Ù„Ø³Ø­Ø¨</div>      
            <div class="action-sub">Ø§Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø£Ø±Ø¨Ø§Ø­Ùƒ</div>      
          </div>      
        </div>      
        <div style="color:var(--muted);font-weight:800">Ø³Ø­Ø¨</div>      
      </a>      
    </div>      
    <div class="stats-row" style="margin-top:14px">      
      <div class="stat-card">      
        <div class="stat-number" id="pointsToday">0</div>      
        <div class="stat-label">Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…</div>      
      </div>      
      <div class="stat-card">      
        <div class="stat-number" id="totalWithdrawn">0 Ø¬</div>      
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª</div>      
      </div>      
      <div class="stat-card">      
        <div class="stat-number" id="referralPoints">0</div>      
        <div class="stat-label">Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</div>      
      </div>      
    </div>      
    <footer>Â© Am Rewards</footer>    
  </div>      
  <div id="toast" class="toast" role="status" aria-live="polite"></div>      
  <script type="module">      
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";      
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";      
    import {     
      getFirestore,     
      doc,     
      updateDoc,     
      onSnapshot,     
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";      

// **1. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª** const firebaseConfig = {      
  apiKey: "AIzaSyBfOJPkWbmcJ6s29bDNysr-H0Kx-Js3Gy0",      
  authDomain: "am--rewards.firebaseapp.com",      
  projectId: "am--rewards",      
};      
const app = initializeApp(firebaseConfig);      
const auth = getAuth(app);      
const db = getFirestore(app);      
    
// **2. Ø§Ù„Ø«ÙˆØ§Ø¨Øª** const POINT_VALUE_EGP = 0.07;      
const DAILY_TARGET = 1000;      

// **3. Ø¹Ù†Ø§ØµØ± DOM** const userNameEl = document.getElementById('userName');      
const userEmailEl = document.getElementById('userEmail');      
const userRefCodeEl = document.getElementById('userRefCode');    
const avatarEl = document.getElementById('avatar');      
const userPointsEl = document.getElementById('userPoints');      
const pointsTodayEl = document.getElementById('pointsToday');      
const totalWithdrawnEl = document.getElementById('totalWithdrawn');      
const progressPercentEl = document.getElementById('progressPercent');      
const progressLblEl = document.getElementById('progressLbl');      
const pointsEgpEl = document.getElementById('pointsEgp');      
const referralPointsEl = document.getElementById('referralPoints');      
const userBalanceEgpEl = document.getElementById('userBalanceEgp');    
const refreshBtn = document.getElementById('refreshBtnTop');      
const logoutBtn = document.getElementById('logoutBtn');      
const toast = document.getElementById('toast');      
const circleWrap = document.getElementById('circleWrap');     
const progressCard = document.getElementById('progressCard'); // Ø¹Ù†ØµØ± Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙ‚Ø¯Ù…     

// **4. Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©** function showToast(text, success = true, duration = 3200) {
    toast.textContent = text;
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙØ¦Ø§Øª Ø«Ù… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
    toast.classList.remove('error'); 
    if (!success) {
        toast.classList.add('error');
    }
    toast.classList.add('show');
    
    // Ø¥Ø®ÙØ§Ø¡ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© (10 Ø«ÙˆØ§Ù†ÙŠ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ØŒ 3.2 Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ù†Ø¬Ø§Ø­)
    clearTimeout(window._toastTimeout);
    window._toastTimeout = setTimeout(() => {
        toast.classList.remove('show');
    }, success ? duration : 10000); 
}      

function getAvatarChar(name, email) {    
    if (name && name.length > 0) return name.trim()[0].toUpperCase();    
    if (email && email.length > 0) return email.trim()[0].toUpperCase();    
    return 'A';    
}    

// **5. Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…** function renderUser(d, user) {      
  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
  userNameEl.textContent = d.name || user.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…';      
  userEmailEl.textContent = d.email || user.email || 'â€”';      
  userRefCodeEl.textContent = `ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©: ${d.referralCode || 'â€”'}`;    
  avatarEl.textContent = getAvatarChar(d.name, user.email);    
      
  // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯
  const pts = Number(d.points ?? 0);      
  const egpBalance = (pts * POINT_VALUE_EGP).toFixed(2);    
      
  userPointsEl.textContent = pts.toLocaleString();     
  pointsEgpEl.textContent = egpBalance + ' Ø¬';     
  userBalanceEgpEl.textContent = egpBalance;     
      
  // Ø­Ø³Ø§Ø¨ Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…
  // ğŸ’¡ Ù†ÙØªØ±Ø¶ Ø£Ù† previousPoints Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ 0 Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
  const prevPts = Number(d.previousPoints ?? 0);    
  const pointsToday = Math.max((pts - prevPts), 0);     
  pointsTodayEl.textContent = pointsToday.toLocaleString();      
      
  // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
  totalWithdrawnEl.textContent = (Number(d.totalWithdrawn ?? 0)).toLocaleString() + ' Ø¬';      
  referralPointsEl.textContent = (Number(d.referralPoints ?? 0)).toLocaleString();      

  // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ ÙˆØ´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… (Ø§Ù„ØªÙ‚Ø¯Ù… Ø®Ù„Ø§Ù„ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ)
  // ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù€ (Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ© % Ø§Ù„Ù‡Ø¯Ù)
  const todayProgress = Math.min(DAILY_TARGET, (pts % DAILY_TARGET));      
  const pct = Math.round((todayProgress / DAILY_TARGET) * 100);      
      
  progressPercentEl.textContent = pct + '%';      
  progressLblEl.textContent = `${todayProgress.toLocaleString()} / ${DAILY_TARGET.toLocaleString()}`;      
      
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© (conic-gradient)
  circleWrap.style.background = `conic-gradient(var(--primary) ${pct}%, rgba(255,255,255,0.02) ${pct}%)`;      

  // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø£ÙÙ‚ÙŠ (CSS variable)
  progressCard.style.setProperty('--progress-pct', `${pct}%`);    
}      

// **6. Ù…Ù†Ø·Ù‚ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Auth State Listener) Ø§Ù„Ù…ÙØ¹Ø¯Ù‘Ù„** onAuthStateChanged(auth, async (user) => {      
  if (!user) return location.href = 'index.html';      
      
  const uid = user.uid;      
  const userRef = doc(db, 'users', uid);      
      
  // Ø±Ø¨Ø· Ù…Ø³ØªÙ…Ø¹ Realtime (onSnapshot)    
  const unsubscribe = onSnapshot(userRef, async (snap) => {    
    if (!snap.exists()) {    
      showToast('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬.', false);      
      unsubscribe(); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø³ØªÙ…Ø¹
      await signOut(auth);    
      return;    
    }    
        
    const data = snap.data();      

    // ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø©: ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ù…Ù†Ø·Ù‚ ØªØ­Ø¯ÙŠØ« previousPoints Ù…Ù† Ù‡Ù†Ø§
    if (data.previousPoints === undefined) {
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø­Ù‚Ù„ Ù…ÙÙ‚ÙˆØ¯Ø§Ù‹ (Ø¨Ø³Ø¨Ø¨ Ø®Ø·Ø£ ØªÙ‡ÙŠØ¦Ø© Ø£Ùˆ Ø­Ø³Ø§Ø¨ Ù‚Ø¯ÙŠÙ…)ØŒ Ù†Ø¹ØªØ¨Ø±Ù‡ 0 Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
      data.previousPoints = 0; 
    }      

    renderUser(data, user);      
        
  }, (error) => {    
    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ø®Ø·Ø§Ø¡ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù†
    showToast('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§ØªÙƒ.', false);    
    console.error("Firestore error:", error);    
  });    

});      

// **7. Ø§Ù„Ø£Ø²Ø±Ø§Ø±** // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙŠØ¯ÙˆÙŠ (Ù„Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ØµØ±ÙŠ ÙÙ‚Ø·)
refreshBtn.addEventListener('click', () => {      
  showToast('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ.', true);     
});      

// Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬    
logoutBtn.addEventListener('click', () => {     
    logoutBtn.disabled = true; // Ù…Ù†Ø¹ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…ØªÙƒØ±Ø±    
    signOut(auth).then(() => {    
        location.href = 'index.html';    
    }).catch((e) => {    
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', false);    
        console.error(e);    
        logoutBtn.disabled = false;    
    });    
});

</script>    
</body>
</html>
