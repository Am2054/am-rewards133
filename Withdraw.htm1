<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ - Am Rewards</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-50 px-4 py-6">

  <div class="max-w-lg mx-auto bg-white p-6 rounded-xl shadow text-right">
    <h2 class="text-xl font-bold mb-4">ğŸ’° Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨</h2>
    <p class="mb-2">Ø±ØµÙŠØ¯Ùƒ: <span id="userPoints" class="font-bold text-green-600">0</span> Ù†Ù‚Ø·Ø©</p>
    <label>ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹:</label>
    <select id="method" class="w-full p-2 border rounded mt-1">
      <option value="vodafone">Vodafone Cash</option>
      <option value="paypal">PayPal</option>
    </select>
    <label class="mt-2 block">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ / Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:</label>
    <input id="account" type="text" class="w-full p-2 border rounded mt-1">
    <button onclick="requestWithdraw()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded">Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨</button>
  </div>

  <script>
    const firebaseConfig = {
      // ğŸ” Ø¨ÙŠØ§Ù†Ø§Øª Firebase
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let userPoints = 0;

    auth.onAuthStateChanged(user => {
      if (user) {
        db.collection("users").doc(user.uid).get().then(doc => {
          userPoints = doc.data().points || 0;
          document.getElementById("userPoints").innerText = userPoints;
        });
      }
    });

    function requestWithdraw() {
      const method = document.getElementById("method").value;
      const account = document.getElementById("account").value;

      if (userPoints < 312.5) {
        alert("ÙŠØ¬Ø¨ Ø£Ù† ØªÙ…Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 312.5 Ù†Ù‚Ø·Ø© Ù„Ù„Ø³Ø­Ø¨ (25 EGP)");
        return;
      }

      auth.onAuthStateChanged(user => {
        if (user) {
          db.collection("withdrawals").add({
            uid: user.uid,
            method,
            account,
            date: new Date(),
            status: "pending",
            amount: userPoints
          }).then(() => {
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ âœ…");
          });
        }
      });
    }
  </script>
</body>
</html>
