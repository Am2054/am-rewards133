<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ | Am Rewards</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #FFD369;
      --accent-glow: rgba(255, 211, 105, 0.4);
      --accent-2: #34d399;
      --bg-dark: #0f172a;
      --card-bg: rgba(15, 23, 42, 0.8);
      --glass-border: rgba(255, 255, 255, 0.1);
      --input-bg: rgba(30, 41, 59, 0.5);
      --text-muted: #94a3b8;
      --error: #fb7185;
      --success: #34d399;
      --radius: 24px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Cairo", sans-serif;
      color: #f8fafc;
      min-height: 100vh;
      background: var(--bg-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow-x: hidden;
    }

    /* Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© ÙÙ†ÙŠØ© */
    .bg-blobs {
      position: fixed; inset: 0; z-index: -1;
      background: radial-gradient(circle at 10% 20%, rgba(52, 211, 153, 0.05) 0%, transparent 40%),
                  radial-gradient(circle at 90% 80%, rgba(255, 211, 105, 0.05) 0%, transparent 40%);
    }

    .center-wrap {
      width: 100%;
      max-width: 1100px;
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 0;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: var(--radius);
      border: 1px solid var(--glass-border);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      overflow: hidden;
    }

    /* Ù‚Ø³Ù… Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
    .hero {
      padding: 60px;
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.8));
      display: flex;
      flex-direction: column;
      justify-content: center;
      border-left: 1px solid var(--glass-border);
    }

    .hero h2 {
      font-family: "Montserrat", sans-serif;
      font-size: 42px;
      color: var(--accent);
      font-weight: 800;
      margin-bottom: 20px;
      text-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    .hero p {
      color: var(--text-muted);
      font-size: 18px;
      line-height: 1.8;
      margin-bottom: 30px;
    }

    .feature-item {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
      font-weight: 600;
      color: #e2e8f0;
    }

    .feature-icon {
      width: 10px; height: 10px;
      background: var(--accent);
      border-radius: 50%;
      box-shadow: 0 0 10px var(--accent);
    }

    /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */
    .signup-card {
      padding: 50px 40px;
      display: flex;
      flex-direction: column;
    }

    .signup-card h3 {
      font-size: 28px;
      font-weight: 900;
      text-align: center;
      margin-bottom: 10px;
      color: #fff;
    }

    .subtitle {
      text-align: center;
      color: var(--text-muted);
      font-size: 14px;
      margin-bottom: 30px;
    }

    label {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-muted);
      margin-bottom: 8px;
      display: block;
      padding-right: 5px;
    }

    .input-wrapper {
      position: relative;
      margin-bottom: 20px;
    }

    input {
      width: 100%;
      padding: 14px 16px;
      background: var(--input-bg);
      border: 1px solid var(--glass-border);
      border-radius: 14px;
      color: #fff;
      font-family: "Cairo";
      font-size: 15px;
      transition: all 0.3s ease;
      outline: none;
    }

    input:focus {
      border-color: var(--accent);
      background: rgba(30, 41, 59, 0.8);
      box-shadow: 0 0 0 4px var(--accent-glow);
    }

    .password-toggle {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 18px;
    }

    /* Strength Meter Ø§Ù„Ù…Ø­Ø³Ù† */
    .strength-meter {
      height: 4px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      margin-top: -12px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .strength-bar { height: 100%; width: 0; transition: width 0.4s ease; }

    .btn-primary {
      width: 100%;
      padding: 16px;
      border-radius: 14px;
      border: none;
      background: linear-gradient(90deg, var(--accent), #f59e0b);
      color: #000;
      font-weight: 900;
      font-size: 17px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-top: 10px;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px -5px var(--accent-glow);
    }

    .btn-primary:active { transform: translateY(0); }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      filter: grayscale(0.5);
    }

    .spinner {
      width: 22px; height: 22px;
      border: 3px solid rgba(0,0,0,0.1);
      border-top-color: #000;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      display: none;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .status {
      margin-top: 15px;
      text-align: center;
      font-size: 14px;
      font-weight: 700;
      min-height: 24px;
      padding: 10px;
      border-radius: 10px;
    }

    .status.error { color: var(--error); background: rgba(251, 113, 133, 0.1); }
    .status.success { color: var(--success); background: rgba(52, 211, 153, 0.1); }

    .footer-link {
      text-align: center;
      margin-top: 25px;
      font-size: 14px;
      color: var(--text-muted);
    }

    .footer-link a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 700;
      margin-right: 5px;
    }

    /* Modal Style */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(10px);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-content {
      background: #1e293b;
      padding: 40px;
      border-radius: 24px;
      max-width: 600px;
      width: 100%;
      border: 1px solid var(--glass-border);
      position: relative;
    }

    .modal-content h2 { color: var(--accent); margin-bottom: 20px; }
    .modal-content li { color: #cbd5e1; margin-bottom: 12px; line-height: 1.6; }

    @media (max-width: 900px) {
      .center-wrap { grid-template-columns: 1fr; }
      .hero { display: none; }
      .signup-card { padding: 40px 25px; }
    }
  </style>
</head>
<body>

  <div class="bg-blobs"></div>

  <div class="center-wrap">
    <div class="hero">
      <h2>Am Rewards</h2>
      <p>Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø±Ø¨Ø­ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¢Ù† Ù…Ø¹ Ø£ÙƒØ«Ø± Ù…Ù†ØµØ© Ø£Ù…Ø§Ù†Ø§Ù‹ ÙˆØ´ÙØ§ÙÙŠØ© ÙÙŠ Ø§Ù„ÙˆØ·Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠ.</p>
      
      <div class="feature-item"><div class="feature-icon"></div>Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø®Ù„Ø§Ù„ Ø£Ù‚Ù„ Ù…Ù† 24 Ø³Ø§Ø¹Ø©</div>
      <div class="feature-item"><div class="feature-icon"></div>Ø¯Ø¹Ù… ÙÙ†ÙŠ Ù…ØªÙˆØ§Ø¬Ø¯ Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¹Ø©</div>
      <div class="feature-item"><div class="feature-icon"></div>Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ù…ØªØ·ÙˆØ± Ø¶Ø¯ Ø§Ù„Ø§Ø­ØªÙŠØ§Ù„</div>
    </div>

    <div class="signup-card">
      <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
      <div class="subtitle">ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¯Ù‚Ø© Ù„Ø¶Ù…Ø§Ù† Ø³Ø±Ø¹Ø© Ø§Ù„Ø³Ø­Ø¨</div>

      <form id="signupForm">
        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <div class="input-wrapper">
          <input id="name" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ" required />
        </div>

        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ Ø£Ùˆ ØºÙŠØ±Ù‡)</label>
        <div class="input-wrapper">
          <input id="phone" type="text" placeholder="01xxxxxxxxx" maxlength="11" required />
        </div>

        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <div class="input-wrapper">
          <input id="email" type="email" placeholder="name@company.com" required />
        </div>

        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <div class="input-wrapper">
          <input id="password" type="password" placeholder="6 Ø£Ø­Ø±Ù Ø£Ùˆ Ø£ÙƒØ«Ø±" required oninput="checkStrength(this.value)" />
          <button type="button" class="password-toggle" id="togglePass">ğŸ‘ï¸</button>
        </div>
        <div class="strength-meter"><div id="strengthBar" class="strength-bar"></div></div>

        <label>ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <div class="input-wrapper">
          <input id="refCode" type="text" placeholder="Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ ÙƒÙˆØ¯ Ø¯Ø§Ø¹ÙŠ" />
        </div>

        <div style="display:flex; align-items:center; gap:10px; margin: 10px 0 20px 0;">
          <input id="agree" type="checkbox" style="width:18px; height:18px;" required />
          <label for="agree" style="margin:0; font-size:12px;">Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <a href="#" onclick="document.getElementById('policyModal').classList.add('open')" style="color:var(--accent); text-decoration:none;">Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a></label>
        </div>

        <button id="signupBtn" class="btn-primary" type="submit">
          <span id="btnText">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† Ù…Ø¬Ø§Ù†Ø§Ù‹</span>
          <div id="loader" class="spinner"></div>
        </button>

        <div id="status" class="status"></div>

        <div class="footer-link">
          Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <a href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
        </div>
      </form>
    </div>
  </div>

  <div id="policyModal" class="modal-overlay">
    <div class="modal-content">
      <h2>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h2>
      <ul style="padding-right: 20px;">
        <li>ÙŠÙÙ…Ù†Ø¹ Ù…Ù†Ø¹Ø§Ù‹ Ø¨Ø§ØªØ§Ù‹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù€ VPN Ø£Ùˆ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ„Ø§Ø¹Ø¨.</li>
        <li>ÙŠÙØ³Ù…Ø­ Ø¨Ø­Ø³Ø§Ø¨ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ù„ÙƒÙ„ Ø¬Ù‡Ø§Ø²ØŒ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© ØªØ¹Ø±Ø¶Ùƒ Ù„Ù„Ø­Ø¸Ø±.</li>
        <li>Ø³Ø¹Ø± Ø§Ù„Ù†Ù‚Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹: 0.07 Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØºÙŠÙŠØ±).</li>
        <li>ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø­Ø¨ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù†Ø²Ø§Ù‡Ø©.</li>
      </ul>
      <button class="btn-primary" style="margin-top:30px" onclick="document.getElementById('policyModal').classList.remove('open')">ÙÙ‡Ù…Øª Ø°Ù„Ùƒ</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, deleteUser } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = { apiKey: "AIzaSyBfOJPkWbmcJ6s29bDNysr-H0Kx-Js3Gy0", authDomain: "am--rewards.firebaseapp.com", projectId: "am--rewards" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const statusEl = document.getElementById('status');
    const signupBtn = document.getElementById('signupBtn');
    const loader = document.getElementById('loader');
    const btnText = document.getElementById('btnText');

    const getDeviceId = () => {
      let id = localStorage.getItem('appDeviceId');
      if (!id) { id = crypto.randomUUID(); localStorage.setItem('appDeviceId', id); }
      return id;
    };

    document.getElementById('togglePass').onclick = () => {
      const p = document.getElementById('password');
      p.type = p.type === 'password' ? 'text' : 'password';
    };

    window.checkStrength = (p) => {
      const bar = document.getElementById('strengthBar');
      let s = 0;
      if(p.length > 5) s += 30; if(/[A-Z]/.test(p)) s += 30; if(/[0-9]/.test(p)) s += 40;
      bar.style.width = s + '%';
      bar.style.background = s < 40 ? '#fb7185' : s < 70 ? '#FFD369' : '#34d399';
    };

    document.getElementById('signupForm').onsubmit = async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const phone = document.getElementById('phone').value.trim();
      const name = document.getElementById('name').value.trim();
      const refCode = document.getElementById('refCode').value.trim().toUpperCase();
      const deviceId = getDeviceId();

      if (password.length < 6) { showErr("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"); return; }
      if (!/^01[0-9]{9}$/.test(phone)) { showErr("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­"); return; }

      signupBtn.disabled = true; loader.style.display = 'block'; btnText.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";
      statusEl.textContent = ""; statusEl.className = "status";

      try {
        const secRes = await fetch('/api/secureSignup', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, deviceId })
        });
        if (!secRes.ok) {
          const r = await secRes.json();
          throw new Error(r.errorCode || 'SECURITY_CHECK_FAILED');
        }

        btnText.textContent = "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...";
        const userCred = await createUserWithEmailAndPassword(auth, email, password);

        btnText.textContent = "Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
        const createRes = await fetch('/api/createUser', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            uid: userCred.user.uid, email, phone, name, deviceId, referralCode: refCode
          })
        });

        if (!createRes.ok) {
          await deleteUser(userCred.user);
          throw new Error("CREATE_ERR");
        }

        statusEl.className = "status success";
        statusEl.textContent = "âœ… ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ù„Ù…Ù†ØµØ©...";
        setTimeout(() => window.location.href = "dashboard.html", 1500);

      } catch (err) {
        signupBtn.disabled = false; loader.style.display = 'none'; btnText.textContent = "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† Ù…Ø¬Ø§Ù†Ø§Ù‹";
        showErr(translateError(err.code || err.message));
      }
    };

    function showErr(m) { statusEl.className = "status error"; statusEl.textContent = "âŒ " + m; }

    function translateError(code) {
      const errors = {
        'auth/email-already-in-use': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„',
        'auth/invalid-email': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ­ÙŠØ­',
        'DEVICE_ALREADY_EXISTS': 'Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ø³Ø¬Ù„ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„',
        'SECURITY_CHECK_FAILED': 'ÙØ´Ù„ ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù† Ù„Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†'
      };
      return errors[code] || "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹";
    }
  </script>
</body>
</html>
