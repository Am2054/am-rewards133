<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ | Am Rewards</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    /* --- Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© --- */
    :root{  
      --accent:#FFD369;  
      --accent-2:#34d399;  
      --primary-bg: #05132f;  
      --card-bg: rgba(12,18,40,0.82);  
      --glass-bg: rgba(255,255,255,0.10);  
      --glass-border: rgba(255,255,255,0.17);  
      --muted: #b8c2cf;  
      --error: #ff6b6b;  
      --success: #4ade80;  
      --shadow: 0 8px 32px 0 rgba(2,6,23,0.35);  
      --radius: 22px;  
    }  

    *{box-sizing:border-box}  
    body{  
      font-family:"Cairo", sans-serif;  
      color:#f1f6fb;  
      min-height:100vh;  
      background: linear-gradient(120deg, #0f2027 0%, #2c5364 100%), url('https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=1500&q=80');  
      background-size:cover; background-attachment:fixed; background-blend-mode:overlay;  
      display:flex; align-items:flex-start; justify-content:center; padding:20px 0; 
    }  

    .animated-bg { position:fixed; inset:0; z-index:0; pointer-events:none; background: radial-gradient(circle at 70% 15%, rgba(52,211,153,0.07) 0%, transparent 60%), radial-gradient(circle at 20% 85%, rgba(255,211,105,0.09) 0%, transparent 60%); animation: movebg 14s infinite alternate; }  
    @keyframes movebg { 0% { background-position: 70% 15%; } 100% { background-position: 65% 35%; } }

    .center-wrap{ width:100%; max-width:1150px; display:grid; grid-template-columns: 1.2fr 1fr; gap:42px; z-index:2; margin:42px 0; background: rgba(255,255,255,0.02); border-radius: var(--radius); box-shadow: var(--shadow); overflow:hidden; }  

    .hero{ background:var(--card-bg); padding:54px 38px; display:flex; flex-direction:column; justify-content:center; }  
    .hero h2{ font-family:"Montserrat", sans-serif; font-size:38px; color:var(--accent); margin-bottom:16px; }  
    .hero p{ color:var(--muted); line-height:1.7; margin-bottom:22px; }  

    .signup-card{ background:var(--glass-bg); border:1.5px solid var(--glass-border); border-radius: var(--radius); padding:38px 32px; backdrop-filter: blur(16px); width:100%; }  
    .form-row{ display:flex; flex-direction:column; gap:13px; width:100%; }  
    
    input { width:100%; padding:13px; border-radius:12px; border:1.5px solid rgba(255,255,255,0.15); background: rgba(32,40,74,0.32); color:#fff; outline:none; }
    input:focus { border-color: var(--accent-2); background: rgba(32,40,74,0.48); }

    .input-wrapper { position: relative; width: 100%; }
    .toggle-password { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; }

    .btn-primary{ margin-top:18px; width:100%; padding:14px; border-radius:13px; border:0; background:linear-gradient(90deg,var(--accent),var(--accent-2)); font-weight:900; cursor:pointer; font-family:"Cairo", sans-serif; }  
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

    .status { margin-top:15px; text-align:center; font-size:14px; min-height: 20px; }
    .status.error { color: var(--error); }
    .status.success { color: var(--success); }

    /* Modal Styles */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; padding: 20px; }
    .modal-overlay.open { display: flex; }
    .modal-content { background: var(--primary-bg); padding: 30px; border-radius: var(--radius); max-width: 600px; border: 1px solid var(--accent); }
    
    @media(max-width:1100px){ .center-wrap{grid-template-columns:1fr; max-width:90%;} }
  </style>
</head>
<body>
  <div class="animated-bg"></div>
  <div class="center-wrap">
    <div class="hero">
      <h2>Am Rewards<span style="color:#fff;font-size:13px;"> â€” Ø§Ø±Ø¨Ø­ Ø¨Ø«Ù‚Ø©</span></h2>
      <p>Ù…Ù†ØµØ© Ù…ÙƒØ§ÙØ¢Øª Ø­Ø¯ÙŠØ«Ø© ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø´ÙØ§ÙÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù†. Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† ÙˆØ§Ø¬Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† Ù…Ù‡Ø§Ù… Ø¨Ø³ÙŠØ·Ø© ÙˆØ§Ø³Ø­Ø¨ Ø£Ø±Ø¨Ø§Ø­Ùƒ ÙÙˆØ±Ø§Ù‹.</p>
      <div class="cta">
        <button class="btn-ghost" style="color:var(--accent); background:none; border:1px solid var(--accent); padding:10px 20px; border-radius:10px; cursor:pointer;">Ø§ÙƒØªØ´Ù Ø§Ù„Ù…Ø²ÙŠØ¯</button>
      </div>
    </div>

    <form class="signup-card" onsubmit="event.preventDefault(); window.signup();">
      <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
      <div class="form-row">
        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input id="name" type="text" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ" required />
        
        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
        <input id="phone" type="text" placeholder="01xxxxxxxxx" maxlength="11" required />
        
        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input id="email" type="email" placeholder="email@example.com" required />
        
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <div class="input-wrapper">
            <input id="password" type="password" placeholder="6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„" required />
            <span class="toggle-password" onclick="togglePasswordVisibility('password')">ğŸ‘ï¸</span>
        </div>

        <label>ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="refCode" type="text" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø¹ÙŠ Ø¥Ù† ÙˆØ¬Ø¯" />
      </div>

      <div style="margin-top:15px; font-size:13px;">
        <input type="checkbox" id="agree" required>
        Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <a href="#" onclick="document.getElementById('policyModal').classList.add('open')" style="color:var(--accent)">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a>
      </div>

      <button id="signupBtn" class="btn-primary" type="submit">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¢Ù†</button>
      <div id="status" class="status"></div>
      
      <div style="text-align:center; margin-top:15px; font-size:14px;">
        Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <a href="login.html" style="color:var(--accent-2)">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ</a>
      </div>
    </form>
  </div>

  <div id="policyModal" class="modal-overlay">
    <div class="modal-content">
      <h2 style="color:var(--accent)">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h2>
      <p style="color:var(--muted); font-size:14px; line-height:1.6;">
        1. ÙŠÙÙ…Ù†Ø¹ Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙƒØ«Ø± Ù…Ù† Ø­Ø³Ø§Ø¨ Ù„Ù†ÙØ³ Ø§Ù„Ø´Ø®Øµ.<br>
        2. Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ù„ØªÙ„Ø§Ø¹Ø¨ Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª ØªØ¤Ø¯ÙŠ Ù„Ù„Ø­Ø¸Ø± Ø§Ù„ÙÙˆØ±ÙŠ.<br>
        3. ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø­Ø¨ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø© Ø¹Ù…Ù„.
      </p>
      <button onclick="document.getElementById('policyModal').classList.remove('open')" class="btn-primary" style="width:auto; padding:8px 20px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, deleteUser } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {  
      apiKey: "AIzaSyBfOJPkWbmcJ6s29bDNysr-H0Kx-Js3Gy0",  
      authDomain: "am--rewards.firebaseapp.com",  
      projectId: "am--rewards",  
      storageBucket: "am--rewards.appspot.com",  
      messagingSenderId: "428582312150",  
      appId: "1:428582312150:web:44e35a70e457e7db4c45df"  
    };  

    const app = initializeApp(firebaseConfig);  
    const auth = getAuth(app);

    // Ø¯Ø§Ù„Ø© Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    window.togglePasswordVisibility = (id) => {
      const el = document.getElementById(id);
      el.type = el.type === "password" ? "text" : "password";
    };

    // Ø¬Ù„Ø¨ Ø§Ù„Ù€ DeviceID Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¤Ù‡
    function getDeviceId() {
      let id = localStorage.getItem('appDeviceId');
      if (!id) {
        id = crypto.randomUUID();
        localStorage.setItem('appDeviceId', id);
      }
      return id;
    }

    // Ø¬Ù„Ø¨ ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    const urlParams = new URLSearchParams(window.location.search);
    if(urlParams.get('ref')) document.getElementById('refCode').value = urlParams.get('ref').toUpperCase();

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    window.signup = async function() {
      const status = document.getElementById('status');
      const btn = document.getElementById('signupBtn');
      
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const refCode = document.getElementById('refCode').value.trim();
      const deviceId = getDeviceId();

      try {
        btn.disabled = true;
        status.className = 'status';
        status.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø£Ù…Ù†ÙŠ...';

        // 1ï¸âƒ£ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø£Ù…Ù†ÙŠ (Backend)
        const secRes = await fetch('/api/secureSignup', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ email, deviceId })
        });
        const secData = await secRes.json();
        if(!secRes.ok) throw new Error(secData.reason);

        // 2ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ Firebase Auth
        status.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...';
        const userCred = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCred.user;

        // 3ï¸âƒ£ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø© (Backend API)
        status.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©...';
        const createRes = await fetch('/api/createUser', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            uid: user.uid,
            email, name, phone, deviceId, referralCode: refCode
          })
        });
        const createData = await createRes.json();

        if(!createRes.ok) {
          await deleteUser(user); // Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù† Auth Ù„Ùˆ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
          throw new Error(createData.reason);
        }

        // âœ… Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        status.className = 'status success';
        status.textContent = 'âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡...';
        setTimeout(() => window.location.href = "dashboard.html", 1500);

      } catch (err) {
        status.className = 'status error';
        status.textContent = 'âŒ ' + (err.message || 'ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„');
        btn.disabled = false;
      }
    };
  </script>
</body>
</html>
